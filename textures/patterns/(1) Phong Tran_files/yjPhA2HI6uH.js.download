if (self.CavalryLogger) { CavalryLogger.start_js(["QMkd8"]); }

__d("ChatNotificationConstants",[],(function a(b,c,d,e,f,g){f.exports={NORMAL:0,NO_USER_MESSAGE_NOTIFICATION:1};}),null);
__d("MercuryMessageSourceTags",[],(function a(b,c,d,e,f,g){f.exports={CHAT:"source:chat",EMAIL:"source:email",MESSENGER:"source:messenger",MOBILE:"source:mobile"};}),null);
__d("MercurySendMessageFields",[],(function a(b,c,d,e,f,g){f.exports={AUTO_RETRY_CNT:"auto_retry_cnt",MANUAL_RETRY_CNT:"manual_retry_cnt"};}),null);
__d("MessengerApprovalModeTypes",[],(function a(b,c,d,e,f,g){f.exports={OPEN:0,APPROVALS:1};}),null);
__d("MessengerJoinableModeType",[],(function a(b,c,d,e,f,g){f.exports={PRIVATE:0,JOINABLE:1};}),null);
__d("OmniMActionType",[],(function a(b,c,d,e,f,g){f.exports={CREATE_EVENT:1,LOCATION:2,PAYMENT:3,POLL:4,STICKER:5,TEXT:6,TRANSPORTATION:7,ORDER_FOOD:8,MAKE_RESERVATION:9,SCHEDULE_CALL:10,LIVE_LOCATION:11,VIDEO_CALL:12,VOICE_CALL:13,SAVE_CONTENT:14,PLAY_GAME:15,SHARE_CONTACT:16,SEND_PHOTO:17,CREATE_REMINDER:18};}),null);
__d("OmniMDirectiveType",[],(function a(b,c,d,e,f,g){f.exports={ADD_ACTIONS:1,CLEAR_ACTIONS:2,ADD_RANGES:3,INVOKE_NATIVE_AGENT:4,MUTATE_FLOW_STATE:5};}),null);
__d("OmniMLoggerEvents",[],(function a(b,c,d,e,f,g){f.exports={MESSAGE_ANALYZED:"omni_m_message_analyzed",INTENT_DETECTED:"omni_m_intent_detected",INTENT_HANDLED:"omni_m_intent_handled",SUGGESTION_GENERATED:"omni_m_suggestion_generated",SUGGESTION_SENT:"omni_m_suggestion_sent",SUGGESTION_DISPLAYED:"omni_m_suggestion_displayed",SUGGESTION_CLICKED:"omni_m_suggestion_clicked",SUGGESTION_COMPLETED:"omni_m_suggestion_completed",SUGGESTION_DISMISSED:"omni_m_suggestion_dismissed",SUGGESTION_DISAPPEARED:"omni_m_suggestion_disappeared",BAR_DISMISSED:"omni_m_bar_dismissed",BAR_DISPLAYED:"omni_m_bar_displayed",BAR_DISAPPEARED:"omni_m_bar_disappeared",ORGANIC_CLICKED:"omni_m_organic_clicked",ORGANIC_COMPLETED:"omni_m_organic_completed"};}),null);
__d('NubController',['ArbiterMixin','Dock'],(function a(b,c,d,e,f,g){function h(){}Object.assign(h.prototype,c('ArbiterMixin'),{init:function i(j){this.el=j;c('Dock').registerNubController(j,this);return this;},buttonContentChanged:function i(){this.inform('nub/button/content-changed');},flyoutContentChanged:function i(){this.inform('nub/flyout/content-changed');},hide:function i(){c('Dock').hide(this.el);},show:function i(){c('Dock').show(this.el);}});f.exports=h;}),null);
__d('BuddyListNub',['csx','cx','fbt','Arbiter','AsyncRequest','AvailableList','BootloadedComponent.react','ChannelConnection','ChatOptions','ChatSidebarActions','ChatSidebarStore','ChatSidebarVisibility','ChatVisibility','CSS','Dock','DOM','Event','intlNumUtils','JSLogger','JSResource','KeyEventController','Keys','NubController','OrderedFriendsList','Parent','PresencePrivacy','PresenceStatus','PresenceUtil','React','ReactDOM','Run','SidebarType','Style','Toggler','emptyFunction'],(function a(b,c,d,e,f,g,h,i,j){var k,l,m=40,n=253,o='285px',p=c('JSLogger').create('buddylist_nub');k=babelHelpers.inherits(q,c('NubController'));l=k&&k.prototype;function q(r,s,t,u){'use strict';l.constructor.call(this);l.init.call(this,r);this.root=r;this.orderedList=s;this.button=c('DOM').find(r,'a.fbNubButton');this.unreadCount=c('DOM').find(r,"span._5ayx");this.label=c('DOM').find(r,'span.label');this.body=c('DOM').scry(r,'div.fbNubFlyoutBody')[0];this.container=c('Parent').bySelector(r,"._56ox");var v=c('DOM').find(r,'div.fbNubFlyoutTitlebar');c('Toggler').createInstance(v).setSticky(false);c('Toggler').createInstance(r).setSticky(true);if(u)c('Run').onAfterLoad(function(){this.dropdown=c('ReactDOM').render(c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:c('React').createElement('span',null),bootloadLoader:c('JSResource')('ChatSidebarDropdown.react').__setRef('BuddyListNub'),onToggleSidebar:function w(){},sidebarType:c('SidebarType').BUDDYLIST}),u);}.bind(this));s.subscribeOnce('render',this.flyoutContentChanged.bind(this));c('Run').onAfterLoad(function(){var w=c('DOM').find(v,"div._4k48");if(w)c('ReactDOM').render(c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:c('React').createElement('span',null),bootloadLoader:c('JSResource')('ChatSidebarComposeLink.react').__setRef('BuddyListNub'),className:"_3a-4"}),w);var x=c('DOM').find(this.button,"div._1us9");if(x)c('ReactDOM').render(c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:c('React').createElement('span',null),bootloadLoader:c('JSResource')('ChatSidebarComposeLink.react').__setRef('BuddyListNub'),className:"_3a-4"}),x);var y=c('DOM').find(this.button,"div._1usa");if(y)c('ReactDOM').render(c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:c('React').createElement('span',null),bootloadLoader:c('JSResource')('ChatSidebarDropdown.react').__setRef('BuddyListNub'),onToggleSidebar:function z(){},sidebarType:c('SidebarType').BUDDYLIST_NUB}),y);}.bind(this));s.setScrollContainer(this.body);c('AvailableList').subscribe('buddylist/availability-changed',this._updateCount.bind(this));c('Arbiter').subscribe('chat/connect',function(){return this._handleConnect(true);}.bind(this));c('Arbiter').subscribe('chat/option-changed',function(w,x){if(x.name=='hide_groups'){this.onResize();}else if(x.name==='hide_buddylist')x.value?this.hide():this.show();}.bind(this));c('ChannelConnection').subscribe(c('ChannelConnection').CONNECTED,function(){return this._updateView();}.bind(this));c('ChannelConnection').subscribe(c('ChannelConnection').SHUTDOWN,function(){return this._updateView();}.bind(this));c('ChannelConnection').subscribe(c('ChannelConnection').RECONNECTING,function(){return this._updateView();}.bind(this));c('ChannelConnection').subscribe([c('ChannelConnection').MUTE_WARNING,c('ChannelConnection').UNMUTE_WARNING],function(){return this._updateView();}.bind(this));this.subscribe('show',this.onShow.bind(this));this.subscribe('hide',this.onHide.bind(this));this.subscribe('resize',this.onResize.bind(this));c('Event').listen(r,'keydown',this._onKeyDown.bind(this));c('Event').listen(this.button,'click',this.onButtonClick.bind(this));c('KeyEventController').registerKey('q',function(event){if(!this._isOpen){this.onButtonClick();this.show();}event.prevent();}.bind(this));c('Arbiter').subscribe('minisidebar/show',this.hide.bind(this));c('Arbiter').subscribe('sidebar/visibility',function(w,x){if(x){this.hide();}else this._onSidebarHide();}.bind(this));c('Style').set(this.body,'min-height',o);c('Arbiter').subscribe('sidebar/typeahead/active',function(w,x){if(x){this._typeaheadActive=true;c('CSS').hide(this.body.parentNode);this.orderedList.hide();this.onResize();}else{this._typeaheadActive=false;this.onResize();c('CSS').show(this.body.parentNode);this.orderedList.show();}}.bind(this));c('OrderedFriendsList').getList(function(w){if(c('ChatSidebarStore').isEnabled()&&c('ChatSidebarStore').getVisibleType()===c('SidebarType').BUDDYLIST&&!c('ChatOptions').getSetting('hide_buddylist')&&!c('ChannelConnection').disconnected()&&!c('PresencePrivacy').isUserOffline()&&w.length>0)this.show();c('Event').listen(v,'click',function(x){if(c('CSS').matchesSelector(x.target,".titlebarTextWrapper"))this._syncHideBuddylist(true);}.bind(this));this._updateView();p.log('buddylist_initialized');}.bind(this));}q.prototype._handleVisibilityChange=function(){'use strict';this._updateView();if(!c('ChatVisibility').isOnline())this.hide();};q.prototype._updateView=function(r){'use strict';var s,t;if(!c('ChatVisibility').isOnline()){s=j._("{Chat} (Off)",[j.param('Chat',j._("Chat"))]);}else if(c('ChannelConnection').disconnected()){s=j._("{Chat} (Disconnected)",[j.param('Chat',j._("Chat"))]);}else{var u=c('PresenceStatus').getOnlineCount();if(u){var v=c('DOM').create('span',{className:'count'},'('+c('intlNumUtils').formatNumberWithThousandDelimiters(u)+')');s=j._({"*":"{Chat} {number-available}"},[j.param('Chat',j._("Chat")),j.param('number-available',v,[0,u])]);}else{s=j._("Chat");t=true;}}this._setPresenceIcon();this._setUnread();this._setLabel(s,t);this.buttonContentChanged();};q.prototype._setPresenceIcon=function(){'use strict';c('CSS').conditionClass(this.root,'offline',!c('ChatVisibility').isOnline()||c('ChannelConnection').disconnected());};q.prototype.onButtonClick=function(){'use strict';if(!c('ChatSidebarStore').isInitialized())return true;c('ChatSidebarVisibility').shouldShowSidebarIgnoreEnabled(null,function(r,s){var t=c('ChatSidebarStore').isEnabled();if(!t&&r){c('ChatSidebarActions').enable(c('SidebarType').SIDEBAR);}else c('ChatSidebarActions').show(t&&r?c('SidebarType').SIDEBAR:c('SidebarType').BUDDYLIST);});};q.prototype.onHide=function(){'use strict';this._isOpen=false;if(this._buddyListRenderSubscription){this.orderedList.unsubscribe(this._buddyListRenderSubscription);this._buddyListRenderSubscription=null;}this._hideBuddyList();c('Arbiter').inform('buddylist/hide');};q.prototype._onKeyDown=function(event){'use strict';var r=c('Event').getKeyCode(event);if(r===c('Keys').ESC&&!c('CSS').hasClass(this.root,'menuOpened')){this.hide();return false;}else if(r==c('Keys').RETURN)c('ChatSidebarVisibility').shouldShowSidebarIgnoreEnabled(null,function(s,t){c('ChatSidebarActions').enable(s?c('SidebarType').SIDEBAR:c('SidebarType').BUDDYLIST);});};q.prototype._onSidebarHide=function(event){'use strict';c('OrderedFriendsList').getList(function(r){if(c('ChatSidebarStore').isEnabled()&&!c('ChatOptions').getSetting('hide_buddylist')&&!c('ChannelConnection').disconnected()&&!c('PresencePrivacy').isUserOffline()&&r.lenth>0){this.show();}else this.hide();}.bind(this));};q.prototype.onResize=function(){'use strict';var r=!this._typeaheadActive?n:c('Dock').getMaxFlyoutHeight(this.root)-60;c('Arbiter').inform('buddyList/resized',r,c('Arbiter').BEHAVIOR_PERSISTENT);if(this._typeaheadActive){c('Style').set(this.body,'max-height','none');}else c('Style').set(this.body,'max-height',o);var s=Math.max(250,r),t=Math.floor(s/m);this.orderedList.setNumTopFriends(t);};q.prototype._showBuddyList=function(){'use strict';this._buddyListRenderSubscription=this.orderedList.subscribe('render',function(){if(c('Style').get(this.body,'height')!=o)c('Style').set(this.body,'height',o);}.bind(this));this.orderedList.show();p.bump('buddylist_show');};q.prototype._hideBuddyList=function(){'use strict';this.orderedList.hide();p.bump('buddylist_hide');};q.prototype.onShow=function(){'use strict';this._isOpen=true;if(c('ChannelConnection').disconnected()){c('ChannelConnection').reconnect();this._showBuddyList();}else c('ChatVisibility').goOnline(this._showBuddyList.bind(this));this._syncHideBuddylist(false);};q.prototype._setLabel=function(r,s){'use strict';var t=this.label.textContent||this.label.innerText;if(t!==r){var u=this.label.cloneNode(true);c('DOM').setContent(u,r);c('DOM').replace(this.label,u);this.label=u;}this.throbber&&c('CSS').conditionShow(this.throbber,!!s);};q.prototype._setUnread=function(r){'use strict';c('CSS').conditionShow(this.unreadCount,!!r);};q.prototype._updateCount=function(){'use strict';this._updateView();};q.prototype._syncHideBuddylist=function(r){'use strict';c('ChatOptions').setSetting('hide_buddylist',r,'buddylist');new (c('AsyncRequest'))('/ajax/chat/settings.php').setHandler(c('emptyFunction')).setErrorHandler(c('emptyFunction')).setData({hide_buddylist:r,window_id:c('PresenceUtil').getSessionID()}).setAllowCrossPageTransition(true).send();};c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(r,s){s.buddylist_visible=c('ChatSidebarStore').getVisibleType()===c('SidebarType').BUDDYLIST;});f.exports=q;}),null);
__d('MercuryFolders',['MercuryFoldersConfig','MessagingTag'],(function a(b,c,d,e,f,g){var h=[c('MessagingTag').INBOX,c('MessagingTag').PENDING,c('MessagingTag').OTHER,c('MessagingTag').ACTION_ARCHIVED],i={getSupportedFolders:function j(){return h.filter(function(k){if(k===c('MessagingTag').PENDING){return !c('MercuryFoldersConfig').hide_message_filtered;}else if(k===c('MessagingTag').OTHER)return !c('MercuryFoldersConfig').hide_message_requests;return true;}).concat();},getFromMeta:function j(k){var l=k.folder;if(k.is_archived)l=c('MessagingTag').ACTION_ARCHIVED;return l;}};f.exports=i;}),null);
__d('MercuryUnreadState',['invariant','MercuryFolders','LogHistory','KeyedCallbackManager','MercuryActionType','MercuryDispatcher','MercuryGlobalActionType','MercurySingletonProvider','MercuryThreadlistConstants','MercuryThreadIDMap','MessagingTag','MercuryServerRequests','MercuryThreadInformer','MercuryThreads','arrayContains','createObjectFrom'],(function a(b,c,d,e,f,g,h){'use strict';var i=(c('MercuryFolders').getSupportedFolders()||[]).filter(function(p){return p!==c('MessagingTag').ACTION_ARCHIVED;}),j='unread_thread_hash',k='unseen_thread_list',l=c('MercuryThreadlistConstants').MAX_UNREAD_COUNT,m=c('LogHistory').getInstance('mercury_unread_state');n.getForFBID=function(p){return o.getForFBID(p);};n.get=function(){return o.get();};function n(p){this.$MercuryUnreadState1=p;this.$MercuryUnreadState2=c('MercuryServerRequests').getForFBID(this.$MercuryUnreadState1);this.$MercuryUnreadState3=c('MercuryThreadIDMap').getForFBID(this.$MercuryUnreadState1);this.$MercuryUnreadState4=c('MercuryThreadInformer').getForFBID(this.$MercuryUnreadState1);this.$MercuryUnreadState5=c('MercuryThreads').getForFBID(this.$MercuryUnreadState1);this.$MercuryUnreadState6=c('MercuryDispatcher').getForFBID(this.$MercuryUnreadState1);this.$MercuryUnreadState7={};this.$MercuryUnreadState8={};this.$MercuryUnreadState9={};this.$MercuryUnreadState10={};this.$MercuryUnreadState11={};i.forEach(function(q){this.$MercuryUnreadState9[q]=0;this.$MercuryUnreadState10[q]=false;this.$MercuryUnreadState11[q]=new (c('KeyedCallbackManager'))();}.bind(this));this.$MercuryUnreadState6.subscribe('update-unread',this.$MercuryUnreadState12.bind(this));this.$MercuryUnreadState6.subscribe('update-thread-ids',function(q,r){this.$MercuryUnreadState13(r);}.bind(this));}n.prototype.getUnreadCount=function(p){if(this.exceedsMaxCount(p)){m.error('unguarded_unread_count_fetch','{}');return 0;}return this.$MercuryUnreadState14(p);};n.prototype.exceedsMaxCount=function(p){return this.$MercuryUnreadState10[p]||this.$MercuryUnreadState14(p)>l;};n.prototype.markFolderAsRead=function(p){if(this.$MercuryUnreadState10[p]||this.$MercuryUnreadState14(p)>0)this.$MercuryUnreadState2.markFolderAsRead(p);};n.prototype.getIsThreadUnread=function(p,q){var r=q||c('MessagingTag').INBOX,s=this.$MercuryUnreadState15(r);return !!(s&&s[p]);};n.prototype.$MercuryUnreadState12=function(p,q){this.$MercuryUnreadState16(q);var r=q.global_actions||[];for(var s=0;s<r.length;s++){var t=r[s];if(t.action_type==c('MercuryGlobalActionType').MARK_ALL_READ)this.$MercuryUnreadState17(t.folder,t.timestamp);}};n.prototype.$MercuryUnreadState18=function(p,q){this.$MercuryUnreadState11[p].setResource(j,q);this.$MercuryUnreadState11[p].setResource(k,Object.keys(q));};n.prototype.$MercuryUnreadState19=function(p,q){var r=this.$MercuryUnreadState11[p].executeOrEnqueue(j,q),s=this.$MercuryUnreadState11[p].getUnavailableResources(r);if(s.length)this.$MercuryUnreadState2.fetchUnreadThreadIDs(p);};n.prototype.$MercuryUnreadState15=function(p){return this.$MercuryUnreadState11[p].getResource(j);};n.prototype.$MercuryUnreadState14=function(p){var q=this.$MercuryUnreadState11[p].getResource(k);if(q){return q.length;}else return this.$MercuryUnreadState9[p];};n.prototype.$MercuryUnreadState16=function(p){var q=void 0;(p.unread_thread_fbids||[]).forEach(function(r){q=r.folder;if(!this.$MercuryUnreadState20(q))return;var s=r.thread_fbids||[];s=s.concat(r.other_user_fbids||[]);var t=this.$MercuryUnreadState21(s);this.$MercuryUnreadState18(q,c('createObjectFrom')(t,true));if(t.length>l)this.$MercuryUnreadState10[q]=true;this.$MercuryUnreadState4.updatedUnreadState();}.bind(this));(p.message_counts||[]).forEach(function(r){if(r.unread_count===undefined)return;q=r.folder;if(r.unread_count>l){this.$MercuryUnreadState10[q]=true;this.$MercuryUnreadState18(q,{});this.$MercuryUnreadState4.updatedUnreadState();}else{this.$MercuryUnreadState9[q]=r.unread_count;if(this.$MercuryUnreadState9[q]===0)this.$MercuryUnreadState18(q,{});this.$MercuryUnreadState4.updatedUnreadState();}}.bind(this));(p.actions||[]).forEach(function(r){var s=c('MercuryActionType'),t=r.other_user_fbid?r.other_user_fbid:r.thread_fbid,u=r.thread_id?r.thread_id:t;if(r.action_type==s.DELETE_THREAD){i.forEach(function(w){this.$MercuryUnreadState22(w,u);}.bind(this));}else if(r.action_type==s.CHANGE_ARCHIVED_STATUS||r.action_type==s.CHANGE_FOLDER){var v=this.$MercuryUnreadState5.getThreadMetaNow(r.thread_id);!!v||h(0);q=c('MercuryFolders').getFromMeta(v);if(this.$MercuryUnreadState20(q)&&v.unread_count>0)this.$MercuryUnreadState23(q,u);i.forEach(function(w){if(w!=q)this.$MercuryUnreadState22(w,u);}.bind(this));}else{q=this.$MercuryUnreadState24(r);if(!this.$MercuryUnreadState20(q))return;if(r.action_type==s.CHANGE_READ_STATUS){if(r.mark_as_read){this.$MercuryUnreadState22(q,u,r.timestamp);}else this.$MercuryUnreadState23(q,u,r.timestamp);}else if(r.action_type==s.USER_GENERATED_MESSAGE||r.action_type==s.LOG_MESSAGE)if(r.is_unread)this.$MercuryUnreadState23(q,u,r.timestamp);}}.bind(this));};n.prototype.$MercuryUnreadState23=function(p,q,r){if(this.$MercuryUnreadState10[p])return;this.$MercuryUnreadState19(p,function(s){var t=this.$MercuryUnreadState7[p]||0,u=this.$MercuryUnreadState8[q]||0,v=r||Number.POSITIVE_INFINITY;if(v>=t&&v>=u&&!s[q]){s[q]=r||0;this.$MercuryUnreadState18(p,s);this.$MercuryUnreadState4.updatedUnreadState();}}.bind(this));};n.prototype.$MercuryUnreadState22=function(p,q,r){if(this.$MercuryUnreadState10[p])return;this.$MercuryUnreadState19(p,function(s){if(r){var t=this.$MercuryUnreadState8[q];if(!t||t<r)this.$MercuryUnreadState8[q]=r;}var u=s[q];if(r&&typeof u=='number'&&r<u)return;if(q in s){delete s[q];this.$MercuryUnreadState18(p,s);this.$MercuryUnreadState4.updatedUnreadState();}}.bind(this));};n.prototype.$MercuryUnreadState17=function(p,q){this.$MercuryUnreadState10[p]=false;this.$MercuryUnreadState18(p,{});this.$MercuryUnreadState7[p]=Math.max(this.$MercuryUnreadState7[p]||0,q||0);this.$MercuryUnreadState4.updatedUnreadState();};n.prototype.$MercuryUnreadState21=function(p){return p.map(this.$MercuryUnreadState3.convertThreadIDIfAvailable,this.$MercuryUnreadState3);};n.prototype.$MercuryUnreadState13=function(p){i.forEach(function(q){var r=this.$MercuryUnreadState15(q);if(!r)return;for(var s in p){var t=p[s];if(r[s]){r[t]=r[s];delete r[s];}}this.$MercuryUnreadState18(q,r);}.bind(this));};n.prototype.$MercuryUnreadState24=function(p){var q=p.thread_id?this.$MercuryUnreadState5.getThreadMetaNow(p.thread_id):null;return q?c('MercuryFolders').getFromMeta(q):p.folder?p.folder:'';};n.prototype.$MercuryUnreadState20=function(p){return c('arrayContains')(i,p);};var o=new (c('MercurySingletonProvider'))(n);f.exports=n;}),null);
__d('isInFocusMode',['WorkFocusModeController'],(function a(b,c,d,e,f,g){var h=c('WorkFocusModeController').WorkFocusMode,i=function j(k){return !!(h&&h.currentViewerInFocusMode(k));};f.exports=i;}),null);
__d('ChatUnreadCount',['ChatDispatcher','ChatUnreadCountActionTypes','Map','MercuryIDs','MercurySingletonProvider','MercuryThreadInformer','MercuryThreads','MercuryUnreadState','isInFocusMode'],(function a(b,c,d,e,f,g){'use strict';h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};function h(j){this.$ChatUnreadCount1=j;this.$ChatUnreadCount2=c('MercuryThreadInformer').getForFBID(j);this.$ChatUnreadCount3=c('MercuryThreads').getForFBID(j);this.$ChatUnreadCount4=new (c('Map'))();this.$ChatUnreadCount5=c('MercuryUnreadState').getForFBID(j);this.setupSubscriptions();}h.prototype.getUnreadCountForUID=function(j){if(!j)return null;var k=c('MercuryIDs').getThreadIDFromUserID(j);if(!this.$ChatUnreadCount5.getIsThreadUnread(k)){this.$ChatUnreadCount4['delete'](j);return 0;}var l=this.$ChatUnreadCount3.getOrFetch(k),m=l&&l.unread_count;this.$ChatUnreadCount4.set(j,m);if(c('isInFocusMode')(k))return 0;return m;};h.prototype.setupSubscriptions=function(){this.$ChatUnreadCount2.subscribe('threads-updated',function(j,k){var l=Object.keys(k).some(function(m){var n=c('MercuryIDs').getUserIDFromThreadID(m);if(!n)return false;var o=this.getUnreadCountForUID(n),p=this.$ChatUnreadCount4.get(n)||0;return o!==p;}.bind(this));if(l)c('ChatDispatcher').dispatch({type:c('ChatUnreadCountActionTypes').COUNT_UPDATED});}.bind(this));this.$ChatUnreadCount2.subscribe('unread-updated',function(){return c('ChatDispatcher').dispatch({type:c('ChatUnreadCountActionTypes').COUNT_UPDATED});});};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;}),null);
__d('SidebarAppTickerResizer',['cx','Animation','Arbiter','AsyncRequest','ChatSidebarActions','ChatSidebarStore','ChatSidebarVisibility','CSS','debounce','Event','SidebarType','SimpleDrag','TickerController','$','queryThenMutateDOM'],(function a(b,c,d,e,f,g,h){var i=1e-7,j=1,k=85,l=171,m=165,n=300,o=46,p=90,q=82,r=150;function s(t,u,v,w,x){'use strict';this.$SidebarAppTickerResizer1=c('$')('pagelet_ticker');this.$SidebarAppTickerResizer2=c('$')('pagelet_canvas_nav_content');this.$SidebarAppTickerResizer3=this.$SidebarAppTickerResizer1.parentNode;this.$SidebarAppTickerResizer4=w;this.$SidebarAppTickerResizer5=x;var y=parseInt(v,10);if(!isNaN(y)){if(y>k)if(y!=this.$SidebarAppTickerResizer6())v=this.$SidebarAppTickerResizer6()+'px';this.$SidebarAppTickerResizer7(y);}this.$SidebarAppTickerResizer2.style.height=v;this.$SidebarAppTickerResizer8(t,u);if(v===null)c('Arbiter').subscribe('AppsDivebar/show-apps',this.$SidebarAppTickerResizer9.bind(this));if(!w){this.$SidebarAppTickerResizer10();c('CSS').hide(t);}c('Arbiter').subscribe('ChatSidebarDropdown/closeTicker',this.$SidebarAppTickerResizer10.bind(this));c('Arbiter').subscribe('ChatSidebarDropdown/openTicker',this.$SidebarAppTickerResizer11.bind(this));c('Arbiter').subscribe('sidebar/visibility',function(z,aa){if(aa)this.$SidebarAppTickerResizer12();}.bind(this));this.$SidebarAppTickerResizer13=c('debounce')(this.$SidebarAppTickerResizer9.bind(this),200);c('Event').listen(window,'resize',this.$SidebarAppTickerResizer13);c('Arbiter').inform('Ticker/resized');}s.prototype.$SidebarAppTickerResizer12=function(){'use strict';var t=Math.round(parseFloat(this.$SidebarAppTickerResizer1.style.height));if(t<=i)return;c('TickerController').show(this.$SidebarAppTickerResizer1);};s.prototype.$SidebarAppTickerResizer9=function(t){'use strict';c('queryThenMutateDOM')(function(){this.$SidebarAppTickerResizer14();}.bind(this),function(){var u=Math.round(parseFloat(this.$SidebarAppTickerResizer1.style.height));if(u>Math.round(this.$SidebarAppTickerResizer15())||this.$SidebarAppTickerResizer16&&this.$SidebarAppTickerResizer16>j){var v=this.$SidebarAppTickerResizer16/this.$SidebarAppTickerResizer17*100,w=this.$SidebarAppTickerResizer18(0,this.$SidebarAppTickerResizer15()-v);if(!(t&&t.type==='resize'))this.$SidebarAppTickerResizer19(w);c('ChatSidebarVisibility').shouldShowSidebar(null,function(x,y){c('ChatSidebarActions').show(x?c('SidebarType').SIDEBAR:c('SidebarType').BUDDYLIST);});}}.bind(this));};s.prototype.$SidebarAppTickerResizer15=function(){'use strict';if(!this.$SidebarAppTickerResizer4)return 0;if(c('ChatSidebarStore').getVisibleType()!==c('SidebarType').SIDEBAR)return p;return Math.min(p,(this.$SidebarAppTickerResizer17-this.$SidebarAppTickerResizer20-q)*100/this.$SidebarAppTickerResizer17);};s.prototype.$SidebarAppTickerResizer8=function(t,u){'use strict';var v=new (c('SimpleDrag'))(t);v.subscribe('start',this.$SidebarAppTickerResizer21.bind(this));v.subscribe(['update','end'],this.$SidebarAppTickerResizer22.bind(this));var w=new (c('SimpleDrag'))(u);w.subscribe('start',this.$SidebarAppTickerResizer21.bind(this));w.subscribe('update',this.$SidebarAppTickerResizer23.bind(this));w.subscribe('end',this.$SidebarAppTickerResizer24.bind(this));};s.prototype.$SidebarAppTickerResizer21=function(t,event){'use strict';this.$SidebarAppTickerResizer25=event.clientY;this.$SidebarAppTickerResizer14();this.$SidebarAppTickerResizer26();};s.prototype.$SidebarAppTickerResizer14=function(){'use strict';this.$SidebarAppTickerResizer20=this.$SidebarAppTickerResizer2.offsetTop;this.$SidebarAppTickerResizer27=this.$SidebarAppTickerResizer1.offsetHeight;this.$SidebarAppTickerResizer17=this.$SidebarAppTickerResizer3.offsetHeight;this.$SidebarAppTickerResizer16=this.$SidebarAppTickerResizer2.offsetHeight;this.$SidebarAppTickerResizer28=this.$SidebarAppTickerResizer16;};s.prototype.$SidebarAppTickerResizer26=function(){'use strict';c('CSS').addClass(this.$SidebarAppTickerResizer3,"_4vfq");};s.prototype.$SidebarAppTickerResizer29=function(){'use strict';c('CSS').removeClass(this.$SidebarAppTickerResizer3,"_4vfq");};s.prototype.$SidebarAppTickerResizer22=function(t,event){'use strict';var u=this.$SidebarAppTickerResizer16/this.$SidebarAppTickerResizer17*100,v=this.$SidebarAppTickerResizer18(event.clientY-this.$SidebarAppTickerResizer25,this.$SidebarAppTickerResizer15()-u);if(t=='end'){this.$SidebarAppTickerResizer29();this.$SidebarAppTickerResizer19(v);}c('ChatSidebarVisibility').shouldShowSidebar(null,function(w,x){c('ChatSidebarActions').show(w?c('SidebarType').SIDEBAR:c('SidebarType').BUDDYLIST);});};s.prototype.$SidebarAppTickerResizer23=function(t,event){'use strict';var u=-this.$SidebarAppTickerResizer16,v=this.$SidebarAppTickerResizer6()-this.$SidebarAppTickerResizer16,w=this.$SidebarAppTickerResizer30(event.clientY-this.$SidebarAppTickerResizer25,u,v);this.$SidebarAppTickerResizer18(-w,this.$SidebarAppTickerResizer15());this.$SidebarAppTickerResizer28=this.$SidebarAppTickerResizer16+w;this.$SidebarAppTickerResizer28=Math.max(j,this.$SidebarAppTickerResizer28);this.$SidebarAppTickerResizer2.style.height=this.$SidebarAppTickerResizer28+'px';};s.prototype.$SidebarAppTickerResizer24=function(t,event){'use strict';var u=this.$SidebarAppTickerResizer28,v=this.$SidebarAppTickerResizer31(this.$SidebarAppTickerResizer28);this.$SidebarAppTickerResizer7(v);var w=this.$SidebarAppTickerResizer18(this.$SidebarAppTickerResizer16-v,this.$SidebarAppTickerResizer15());if(this.$SidebarAppTickerResizer16!=v){this.$SidebarAppTickerResizer32(v);this.$SidebarAppTickerResizer19(w);}new (c('Animation'))(this.$SidebarAppTickerResizer2).from('height',u).to('height',v).duration(n).go();};s.prototype.$SidebarAppTickerResizer7=function(t){'use strict';if(!this.$SidebarAppTickerResizer5)return;var u="_3qrt",v=document.getElementsByClassName(u),w='';if(t==this.$SidebarAppTickerResizer33()){w='inline';}else w='';for(var x=0;x<v.length;x++)v[x].style.display=w;};s.prototype.$SidebarAppTickerResizer18=function(t,u){'use strict';var v=this.$SidebarAppTickerResizer27+t,w=v/this.$SidebarAppTickerResizer17*100;w=Math.max(i,Math.min(u,w));this.$SidebarAppTickerResizer1.style.height=w+'%';if(w!=i){c('CSS').removeClass(this.$SidebarAppTickerResizer1,'hidden_elem');this.$SidebarAppTickerResizer12();}return w;};s.prototype.$SidebarAppTickerResizer31=function(t){'use strict';var u=this.$SidebarAppTickerResizer33(),v=this.$SidebarAppTickerResizer6();return t<v-o?t<u-o?j:u:v;};s.prototype.$SidebarAppTickerResizer33=function(){'use strict';return k;};s.prototype.$SidebarAppTickerResizer6=function(){'use strict';if(this.$SidebarAppTickerResizer5){return m;}else return l;};s.prototype.$SidebarAppTickerResizer34=function(t){'use strict';var u=this.$SidebarAppTickerResizer6();return t<0?j:t>u?u:t;};s.prototype.$SidebarAppTickerResizer30=function(t,u,v){'use strict';return t<u?u:t>v?v:t;};s.prototype.$SidebarAppTickerResizer19=function(t){'use strict';new (c('AsyncRequest'))('/ajax/feed/ticker/resize').setData({height:''+t}).setMethod('POST').send();c('Arbiter').inform('Ticker/resized');};s.prototype.$SidebarAppTickerResizer32=function(t){'use strict';new (c('AsyncRequest'))('/ajax/feed/apps/resize').setData({height:''+t}).setMethod('POST').send();};s.prototype.$SidebarAppTickerResizer35=function(t){'use strict';var u=this.$SidebarAppTickerResizer27,v=this.$SidebarAppTickerResizer17*t/100;new (c('Animation'))(this.$SidebarAppTickerResizer1).from('height',u).to('height',v).duration(r).ondone(function(){this.$SidebarAppTickerResizer1.style.height=t+'%';this.$SidebarAppTickerResizer19(t===0?'0.0':t);c('ChatSidebarVisibility').shouldShowSidebar(null,function(w,x){c('ChatSidebarActions').show(w?c('SidebarType').SIDEBAR:c('SidebarType').BUDDYLIST);});}.bind(this)).go();};s.prototype.$SidebarAppTickerResizer10=function(){'use strict';this.$SidebarAppTickerResizer14();this.$SidebarAppTickerResizer35(0);};s.prototype.$SidebarAppTickerResizer11=function(){'use strict';this.$SidebarAppTickerResizer1.style.height='40px';c('TickerController').show(this.$SidebarAppTickerResizer1,function(){this.$SidebarAppTickerResizer14();var t=(this.$SidebarAppTickerResizer17-this.$SidebarAppTickerResizer20-q-this.$SidebarAppTickerResizer16)*50/this.$SidebarAppTickerResizer17;this.$SidebarAppTickerResizer35(t);}.bind(this));};f.exports=s;}),null);
__d('OmniMEventTypedLogger',['Banzai','GeneratedLoggerUtils','nullthrows'],(function a(b,c,d,e,f,g){'use strict';function h(){this.clear();}h.prototype.log=function(){c('GeneratedLoggerUtils').log('logger:OmniMEventLoggerConfig',this.$OmniMEventTypedLogger1,c('Banzai').BASIC);};h.prototype.logVital=function(){c('GeneratedLoggerUtils').log('logger:OmniMEventLoggerConfig',this.$OmniMEventTypedLogger1,c('Banzai').VITAL);};h.prototype.clear=function(){this.$OmniMEventTypedLogger1={};return this;};h.prototype.updateData=function(j){this.$OmniMEventTypedLogger1=babelHelpers['extends']({},this.$OmniMEventTypedLogger1,j);return this;};h.prototype.setActionID=function(j){this.$OmniMEventTypedLogger1.action_id=j;return this;};h.prototype.setActionTypeFromBlob=function(j){this.$OmniMEventTypedLogger1.action_type_from_blob=j;return this;};h.prototype.setAgentName=function(j){this.$OmniMEventTypedLogger1.agent_name=j;return this;};h.prototype.setAppID=function(j){this.$OmniMEventTypedLogger1.appid=j;return this;};h.prototype.setAppversion=function(j){this.$OmniMEventTypedLogger1.appversion=j;return this;};h.prototype.setClientUserID=function(j){this.$OmniMEventTypedLogger1.client_userid=j;return this;};h.prototype.setClienttime=function(j){this.$OmniMEventTypedLogger1.clienttime=j;return this;};h.prototype.setConfidence=function(j){this.$OmniMEventTypedLogger1.confidence=j;return this;};h.prototype.setConfidenceRemapped=function(j){this.$OmniMEventTypedLogger1.confidence_remapped=j;return this;};h.prototype.setContextUserID=function(j){this.$OmniMEventTypedLogger1.context_user_id=j;return this;};h.prototype.setCuApp=function(j){this.$OmniMEventTypedLogger1.cu_app=j;return this;};h.prototype.setEventName=function(j){this.$OmniMEventTypedLogger1.event_name=j;return this;};h.prototype.setIntentID=function(j){this.$OmniMEventTypedLogger1.intent_id=j;return this;};h.prototype.setMessageID=function(j){this.$OmniMEventTypedLogger1.message_id=j;return this;};h.prototype.setMessageLength=function(j){this.$OmniMEventTypedLogger1.message_length=j;return this;};h.prototype.setName=function(j){this.$OmniMEventTypedLogger1.name=j;return this;};h.prototype.setPersonalization=function(j){this.$OmniMEventTypedLogger1.personalization=j;return this;};h.prototype.setPigeonID=function(j){this.$OmniMEventTypedLogger1.pigeon_id=j;return this;};h.prototype.setPosition=function(j){this.$OmniMEventTypedLogger1.position=j;return this;};h.prototype.setSource=function(j){this.$OmniMEventTypedLogger1.source=j;return this;};h.prototype.setSuggestionData=function(j){this.$OmniMEventTypedLogger1.suggestion_data=c('GeneratedLoggerUtils').serializeMap(j);return this;};h.prototype.setSuggestionIds=function(j){this.$OmniMEventTypedLogger1.suggestion_ids=c('GeneratedLoggerUtils').serializeVector(j);return this;};h.prototype.setSuggestionMode=function(j){this.$OmniMEventTypedLogger1.suggestion_mode=j;return this;};h.prototype.setSuggestionTitle=function(j){this.$OmniMEventTypedLogger1.suggestion_title=j;return this;};h.prototype.setSuggestionType=function(j){this.$OmniMEventTypedLogger1.suggestion_type=j;return this;};h.prototype.setThreadID=function(j){this.$OmniMEventTypedLogger1.thread_id=j;return this;};h.prototype.setTotalSuggestions=function(j){this.$OmniMEventTypedLogger1.total_suggestions=j;return this;};h.prototype.setVC=function(j){this.$OmniMEventTypedLogger1.vc=j;return this;};var i={action_id:true,action_type_from_blob:true,agent_name:true,appid:true,appversion:true,client_userid:true,clienttime:true,confidence:true,confidence_remapped:true,context_user_id:true,cu_app:true,event_name:true,intent_id:true,message_id:true,message_length:true,name:true,personalization:true,pigeon_id:true,position:true,source:true,suggestion_data:true,suggestion_ids:true,suggestion_mode:true,suggestion_title:true,suggestion_type:true,thread_id:true,total_suggestions:true,vc:true};f.exports=h;}),null);
__d('MercuryMessageObject',['fbt','BanzaiODS','MercuryActionStatus','MercuryActionType','MercuryIDs','MercuryLocalIDs','MercuryMessageClientState','MercuryMessageSourceTags','MercurySingletonProvider','MercurySourceType','MercuryThreads','MercuryTimePassed','MercuryTimestamp','MercurySendMessageFields','formatDate'],(function a(b,c,d,e,f,g,h){i.getForFBID=function(m){'use strict';return l.getForFBID(m);};i.get=function(){'use strict';return l.get();};function i(m){'use strict';this.$MercuryMessageObject1=m;this.$MercuryMessageObject2=c('MercuryThreads').getForFBID(m);}i.prototype.constructUserGeneratedMessageObject=function(m,n,o,p,q){'use strict';var r=j(this.$MercuryMessageObject1,c('MercuryActionType').USER_GENERATED_MESSAGE,n,o);if(typeof m=='string')m=m.replace(/^\s+/,'').replace(/\s+$/,'');r.body=m;r.has_attachment=false;r.html_body=false;r.attachments=[];r.specific_to_list=p||[];r.creator_info=q;return r;};i.prototype.constructStickerMessageObject=function(m,n,o){'use strict';var p=j(this.$MercuryMessageObject1,c('MercuryActionType').USER_GENERATED_MESSAGE,n,o);p.has_attachment=true;p.html_body=false;p.attachments=[];p.sticker_id=m;p.specific_to_list=[];return p;};i.prototype.constructAttachmentMessageObject=function(m,n){'use strict';var o=j(this.$MercuryMessageObject1,c('MercuryActionType').USER_GENERATED_MESSAGE,m,n);o.attachments=[];o.specific_to_list=[];return o;};i.prototype.constructLogMessageObject=function(m,n,o,p){'use strict';var q=j(this.$MercuryMessageObject1,c('MercuryActionType').LOG_MESSAGE,m,n);q.log_message_type=o;q.log_message_data=p;if(p&&p.untypedData&&p.untypedData.ttl)q.ephemeral_ttl_mode=p.untypedData.ttl;return q;};i.prototype.constructCTAConfirmationMessageObject=function(m,n,o,p){var q=arguments.length<=4||arguments[4]===undefined?null:arguments[4];'use strict';var r=this.constructUserGeneratedMessageObject(m,n,o,null,null),s={};if(p){s={quick_replies:p,ignore_for_webhook:false};}else s={ignore_for_webhook:true};r.platform_xmd=JSON.stringify(s);if(q&&q.length>0)r.tags=q;return r;};i.prototype.normalizeNewMessage=function(m){'use strict';if(m.status===undefined)m.status=c('MercuryActionStatus').UNSENT;m.offline_threading_id=m.offline_threading_id||c('MercuryLocalIDs').generateOfflineThreadingID(m.timestamp);if(!m.offline_threading_id)c('BanzaiODS').bumpEntityKey('chat.web','invalid_otid_generated');m.message_id=m.message_id||m.offline_threading_id;var n=c('MercuryIDs').getParticipantIDFromUserID(this.$MercuryMessageObject1);m.specific_to_list=m.specific_to_list||[];if(m.specific_to_list.length&&m.specific_to_list.indexOf(n)===-1)m.specific_to_list.push(n);if(!m.thread_id){m.thread_id='root:'+m.offline_threading_id;}else{var o=this.$MercuryMessageObject2.getThreadMetaNow(m.thread_id);if(o&&o.ephemeral_ttl_mode!==null&&m.ephemeral_ttl_mode===undefined)m.ephemeral_ttl_mode=o.ephemeral_ttl_mode;}if(m.specific_to_list.length==1){m.thread_id='user:'+this.$MercuryMessageObject1;}else if(m.specific_to_list.length==2){var p=m.specific_to_list[0]==n?m.specific_to_list[1]:m.specific_to_list[0];m.thread_id=c('MercuryIDs').getThreadIDFromParticipantID(p);}if(!m.specific_to_list.length){var q=c('MercuryIDs').tokenize(m.thread_id),r=q.type,s=q.value;if(r=='user')m.specific_to_list=['fbid:'+s,n];}if(!m[c('MercurySendMessageFields').MANUAL_RETRY_CNT])m[c('MercurySendMessageFields').MANUAL_RETRY_CNT]=0;};i.prototype.normalizeResendMessage=function(m){'use strict';m.status=c('MercuryActionStatus').RESENDING;m.timestamp=Date.now();m[c('MercurySendMessageFields').MANUAL_RETRY_CNT]+=1;};i.prototype.normalizeAddAttachmentPlaceholder=function(m,n,o){'use strict';if(o.preview_attachments.length>0){m.has_attachment=true;m.preview_attachments=o.preview_attachments;}m.client_state=c('MercuryMessageClientState').DO_NOT_SEND_TO_SERVER;m.status=c('MercuryActionStatus').RESENDING;m.upload_id=n;};function j(m,n,o,p){var q=k(o)?[c('MercuryMessageSourceTags').CHAT]:[],r=Date.now(),s={action_type:n,thread_id:p,author:c('MercuryIDs').getParticipantIDFromUserID(m),author_email:null,timestamp:r,is_unread:false,is_filtered_content:false,is_filtered_content_bh:false,is_filtered_content_account:false,is_filtered_content_quasar:false,is_filtered_content_invalid_app:false,is_spoof_warning:false,source:o,source_tags:q};return s;}function k(m){switch(m){case c('MercurySourceType').CHAT_WEB:case c('MercurySourceType').CHAT_JABBER:case c('MercurySourceType').CHAT_IPHONE:case c('MercurySourceType').CHAT_MEEBO:case c('MercurySourceType').CHAT_ORCA:case c('MercurySourceType').CHAT_TEST:case c('MercurySourceType').CHAT:return true;default:return false;}}var l=new (c('MercurySingletonProvider'))(i);f.exports=i;}),null);
__d('MercuryMessageActions',['MercuryActionType','MercuryDispatcher','MercuryMessageObject','MercuryPayloadSource','MercuryServerRequests','MercurySingletonMixin'],(function a(b,c,d,e,f,g){'use strict';function h(i){this.$MercuryMessageActions1=i;this.$MercuryMessageActions2=c('MercuryMessageObject').getForFBID(this.$MercuryMessageActions1);this.__serverRequests=c('MercuryServerRequests').getForFBID(this.$MercuryMessageActions1);this.__dispatcher=c('MercuryDispatcher').getForFBID(this.$MercuryMessageActions1);}h.prototype.send=function(i,j,k){j=j||Function.prototype;this.$MercuryMessageActions2.normalizeNewMessage(i);this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload(babelHelpers['extends']({},i),c('MercuryPayloadSource').CLIENT_SEND_MESSAGE));this.__serverRequests.sendNewMessage(i,k);j(i.thread_id);};h.prototype.resend=function(i,j){var k=babelHelpers['extends']({},i);this.$MercuryMessageActions2.normalizeResendMessage(k);this.send(k,undefined,j);};h.prototype.addAttachmentPlaceholder=function(i,j,k){this.$MercuryMessageActions2.normalizeAddAttachmentPlaceholder(i,j,k);this.$MercuryMessageActions2.normalizeNewMessage(i);this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload(babelHelpers['extends']({},i),c('MercuryPayloadSource').CLIENT_SEND_MESSAGE));};h.prototype.cancelAttachmentPlaceholder=function(i,j){this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload({upload_id:i,upload_data:j,action_type:c('MercuryActionType').CANCEL_ATTACHMENT_PLACEHOLDER},c('MercuryPayloadSource').CLIENT_SEND_MESSAGE));};h.prototype.confirmAttachmentPlaceholder=function(i,j){this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload({upload_id:i,upload_data:j,action_type:c('MercuryActionType').CONFIRM_ATTACHMENT_PLACEHOLDER},c('MercuryPayloadSource').CLIENT_SEND_MESSAGE));};h.prototype['delete']=function(i,j,k){this.__dispatcher.handleUpdate(this.$MercuryMessageActions3(i,j,c('MercuryActionType').DELETE_MESSAGES,k||c('MercuryPayloadSource').CLIENT_DELETE_MESSAGES));};h.prototype.unwrap=function(i){this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload({thread_id:i.thread_id,unwrapped_message_id:i.message_id,action_type:c('MercuryActionType').UNWRAP_MESSAGE},c('MercuryPayloadSource').CLIENT_UNWRAP_MESSAGE));};h.prototype.__constructClientSingleMessagePayload=function(i,j){return {actions:[i],from_client:true,payload_source:j};};h.prototype.$MercuryMessageActions4=function(i,j){return {actions:[i],from_client:false,payload_source:j};};h.prototype.$MercuryMessageActions3=function(i,j,k,l){return {actions:[{action_type:k,thread_id:i,message_ids:j}],from_client:true,payload_source:l};};Object.assign(h,c('MercurySingletonMixin'));f.exports=h;}),null);
__d("XMercuryThreadLikeIconController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/mercury\/like_icon\/",{emoji:{type:"String",defaultValue:""}});}),null);
__d("XMessagingBlockMessagesController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/block_messages\/",{});}),null);
__d("XMessagingGroupJoinThroughHashController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/join_through_hash\/",{link_hash:{type:"String"}});}),null);
__d("XMessagingGroupJoinableAcceptController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/joinable_accept\/",{thread_fbid:{type:"String"},user_id:{type:"Int"}});}),null);
__d("XMessagingGroupJoinableInviteController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/joinable_invite\/",{thread_fbid:{type:"String"},user_ids:{type:"IntSet"}});}),null);
__d("XMessagingGroupJoinableRejectController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/joinable_reject\/",{thread_fbid:{type:"String"},user_id:{type:"Int"}});}),null);
__d("XMessagingGroupSetApprovalController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/set_approval_mode\/",{set_mode:{type:"Enum",enumType:0},thread_fbid:{type:"String"}});}),null);
__d("XMessagingGroupSetJoinableController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/set_joinable_mode\/",{set_mode:{type:"Enum",enumType:0},thread_fbid:{type:"String"}});}),null);
__d("XMessagingSaveAdminsController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/save_admins\/",{elem_id:{type:"String"},parent_elem_id:{type:"String"},thread_fbid:{type:"String"},admin_ids:{type:"FBIDSet"},add:{type:"Bool",defaultValue:false}});}),null);
__d("XMessagingSaveNicknameController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/save_thread_nickname\/",{source:{type:"Enum",required:true,enumType:1}});}),null);
__d("XMessagingSaveThreadColorController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/save_thread_color\/",{source:{type:"Enum",required:true,enumType:1}});}),null);
__d("XMessagingSaveThreadEmojiController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/save_thread_emoji\/",{source:{type:"Enum",required:true,enumType:1}});}),null);
__d("XMessagingUnblockMessagesController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/unblock_messages\/",{});}),null);
__d("XNFXMessengerBlockActionController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/nfx\/block_messages\/",{thread_fbid:{type:"Int",required:true},av:{type:"Int"},location:{type:"Enum",required:true,enumType:1},__asyncDialog:{type:"Int"}});}),null);
__d('MercuryThreadActions',['cssVar','AsyncDialog','AsyncRequest','EmojiLikeConstants','MercuryActionType','MercuryAPIArgsSource','MercuryDispatcher','MercuryIDs','MercuryLogMessageType','MercuryMessengerBlockingUtils','MercuryPayloadSource','MercuryServerPayloadPreprocessor','MercuryServerRequests','MercurySingletonMixin','MercurySourceType','MercuryThreadIDMap','MercuryThreads','MercuryViewer','MercuryMessageActions','MercuryMessageObject','MessagingTag','URI','XMercuryThreadLikeIconController','XMessagingGroupJoinableAcceptController','XMessagingGroupJoinableInviteController','XMessagingGroupJoinableRejectController','XMessagingGroupJoinThroughHashController','XMessagingGroupSetApprovalController','XMessagingGroupSetJoinableController','XMessagingSaveAdminsController','XMessagingSaveNicknameController','XMessagingSaveThreadColorController','XMessagingSaveThreadEmojiController','XNFXMessengerBlockActionController','XMessagingBlockMessagesController','XMessagingUnblockMessagesController'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('MercuryThreadIDMap').get(),j=c('MercuryThreads').get(),k=c('MercuryMessageActions').get(),l=c('MercuryMessageObject').get();function m(n){this.$MercuryThreadActions1=n;this.__serverRequests=c('MercuryServerRequests').getForFBID(this.$MercuryThreadActions1);this.__dispatcher=c('MercuryDispatcher').getForFBID(this.$MercuryThreadActions1);this.__payloadPreprocessor=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercuryThreadActions1);}m.prototype.markRead=function(n,o){this.batchMarkRead([n],o);};m.prototype.batchMarkRead=function(n,o){this.__dispatcher.handleUpdate(this.$MercuryThreadActions2(n,true,o));};m.prototype.markUnread=function(n,o){this.batchMarkUnread([n],o);};m.prototype.batchMarkUnread=function(n,o){this.__dispatcher.handleUpdate(this.$MercuryThreadActions2(n,false,o));};m.prototype.markSeen=function(n,o){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').MARK_THREAD_SEEN,c('MercuryPayloadSource').CLIENT_MARK_THREAD_SEEN,{persistent:o}));};m.prototype.archive=function(n,o){this.batchArchive([n],o);};m.prototype.batchArchive=function(n,o){n.forEach(function(p){this.__serverRequests.changeThreadArchivedStatus(p,true,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions3(n,true));};m.prototype.unarchive=function(n,o){this.batchUnarchive([n],o);};m.prototype.batchUnarchive=function(n,o){n.forEach(function(p){this.__serverRequests.changeThreadArchivedStatus(p,false,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions3(n,false));};m.prototype.markSpam=function(n,o){this.batchMarkSpam([n],o);};m.prototype.batchMarkSpam=function(n,o){n.forEach(function(p){this.__serverRequests.markThreadSpam(p,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(n,c('MessagingTag').SPAM));};m.prototype.unmarkSpam=function(n,o){this.batchUnmarkSpam([n],o);};m.prototype.batchUnmarkSpam=function(n,o){n.forEach(function(p){this.__serverRequests.unmarkThreadSpam(p,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(n,c('MessagingTag').INBOX));};m.prototype.changeFolder=function(n,o){this.batchChangeFolder([n],o);};m.prototype.batchChangeFolder=function(n,o){n.forEach(function(p){this.__serverRequests.changeThreadFolder(p,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(n,o));};m.prototype['delete']=function(n,o){this.batchDelete([n],o);};m.prototype.batchDelete=function(n,o){n.forEach(function(p){this.__serverRequests.deleteThread(p,o);}.bind(this));this.__dispatcher.handleUpdate(this.__constructClientPayload(n,c('MercuryActionType').DELETE_THREAD,c('MercuryPayloadSource').CLIENT_DELETE_THREAD));};m.prototype.unmute=function(n){this.updateMuteSetting(n,0);};m.prototype.updateMuteSetting=function(n,o){this.__serverRequests.changeMutingOnThread(n,o);this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').CHANGE_MUTE_SETTINGS,c('MercuryPayloadSource').CLIENT_CHANGE_MUTE_SETTINGS,{mute_until:o}));};m.prototype.updateMentionsMuteSetting=function(n,o){var p=o?1:0;this.__serverRequests.changeMentionsMutingOnThread(n,p);this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').CHANGE_MUTE_SETTINGS,c('MercuryPayloadSource').CLIENT_CHANGE_MUTE_SETTINGS,{mentions_mute_mode:p}));};m.prototype.updateReactionsMuteSetting=function(n,o){var p=o?1:0;this.__serverRequests.changeReactionsMutingOnThread(n,p);this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').CHANGE_MUTE_SETTINGS,c('MercuryPayloadSource').CLIENT_CHANGE_MUTE_SETTINGS,{reactions_mute_mode:p}));};m.prototype.blockMessages=function(n){var o=c('XNFXMessengerBlockActionController').getURIBuilder().setInt('thread_fbid',c('MercuryIDs').getUserIDFromThreadID(n)).setEnum('location','www_chat_head').getURI();c('AsyncDialog').send(new (c('AsyncRequest'))(o));};m.prototype.unblockMessages=function(n){var o=JSON.stringify({reportable_ent_token:c('MercuryIDs').getUserIDFromThreadID(n),initial_action_name:c('MercuryMessengerBlockingUtils').block_messages});new (c('AsyncRequest'))(new (c('URI'))('/ajax/nfx/messenger_undo_block').addQueryData({story_location:'messenger',context:o})).send();};m.prototype.blockOnMessengerDotCom=function(n){var o=c('XMessagingBlockMessagesController').getURIBuilder().getURI();new (c('AsyncRequest'))(o).setMethod('POST').setData({fbid:c('MercuryIDs').getUserIDFromThreadID(n)}).send();};m.prototype.unblockOnMessengerDotCom=function(n){var o=c('XMessagingUnblockMessagesController').getURIBuilder().getURI();new (c('AsyncRequest'))(o).setMethod('POST').setData({fbid:c('MercuryIDs').getUserIDFromThreadID(n)}).send();};m.prototype.leaveGroup=function(n){if(!j.isEmptyLocalThread(n))k.send(l.constructLogMessageObject(c('MercurySourceType').TITAN_WEB,n,c('MercuryLogMessageType').UNSUBSCRIBE,{removed_participants:[c('MercuryViewer').getID()]}),null,c('MercuryAPIArgsSource').WEBMESSENGER);};m.prototype.changeThreadColor=function(n,o,p){if(j.isEmptyLocalThread(n))return;i.getServerIDFromClientID(n,function(q){var r={};if(o!="#0084ff")r.color_choice=o;r.thread_or_other_fbid=q;var s=c('XMessagingSaveThreadColorController').getURIBuilder().setEnum('source',p).getURI();new (c('AsyncRequest'))(s).setMethod('POST').setData(r).send();});};m.prototype.changeThreadEmoji=function(n,o,p){if(j.isEmptyLocalThread(n))return;i.getServerIDFromClientID(n,function(q){var r={},s=String.fromCodePoint.apply(String,o);if(s!==String.fromCodePoint(c('EmojiLikeConstants').FB_THUMBS_UP_EMOJI)&&s!==String.fromCodePoint(c('EmojiLikeConstants').THUMBS_UP_EMOJI_CODES))r.emoji_choice=s;r.thread_or_other_fbid=q;var t=c('XMessagingSaveThreadEmojiController').getURIBuilder().setEnum('source',p).getURI();new (c('AsyncRequest'))(t).setMethod('POST').setData(r).send();});};m.prototype.changeThreadNicknames=function(n,o,p,q){if(j.isEmptyLocalThread(n))return;i.getServerIDFromClientID(n,function(r){var s={thread_or_other_fbid:r,participant_id:o,nickname:p},t=c('XMessagingSaveNicknameController').getURIBuilder().setEnum('source',q).getURI();new (c('AsyncRequest'))(t).setMethod('POST').setData(s).send();});};m.prototype.setJoinableMode=function(n,o){var p=c('XMessagingGroupSetJoinableController').getURIBuilder().getURI();new (c('AsyncRequest'))(p).setMethod('POST').setData({set_mode:n,thread_fbid:o.thread_fbid}).send();};m.prototype.setApprovalMode=function(n,o){var p=c('XMessagingGroupSetApprovalController').getURIBuilder().getURI();new (c('AsyncRequest'))(p).setMethod('POST').setData({set_mode:n,thread_fbid:o.thread_fbid}).send();};m.prototype.changeGroupAdmins=function(n,o,p){var q={thread_fbid:n,admin_ids:o,add:p},r=c('XMessagingSaveAdminsController').getURIBuilder().getURI();new (c('AsyncRequest'))(r).setMethod('POST').setData(q).send();};m.prototype.joinThroughHash=function(n){var o={link_hash:n},p=c('XMessagingGroupJoinThroughHashController').getURIBuilder().getURI();new (c('AsyncRequest'))(p).setMethod('POST').setData(o).send();};m.prototype.inviteToJoinableGroup=function(n,o){var p={thread_fbid:n,user_ids:o},q=c('XMessagingGroupJoinableInviteController').getURIBuilder().getURI();new (c('AsyncRequest'))(q).setMethod('POST').setData(p).send();};m.prototype.acceptToJoinableGroup=function(n,o){var p={thread_fbid:n,user_id:o},q=c('XMessagingGroupJoinableAcceptController').getURIBuilder().getURI();new (c('AsyncRequest'))(q).setMethod('POST').setData(p).send();};m.prototype.rejectToJoinableGroup=function(n,o){var p={thread_fbid:n,user_id:o},q=c('XMessagingGroupJoinableRejectController').getURIBuilder().getURI();new (c('AsyncRequest'))(q).setMethod('POST').setData(p).send();};m.prototype.addParticipants=function(n,o){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').ADD_PARTICIPANTS,c('MercuryPayloadSource').CLIENT_ADD_PARTICIPANTS,{participants:o}));};m.prototype.updateCustomLike=function(n,o){var p=c('XMercuryThreadLikeIconController').getURIBuilder().setString('emoji',o).getURI();new (c('AsyncRequest'))().setURI(p).setHandler(function(q){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').UPDATE_CUSTOM_LIKE,c('MercuryPayloadSource').CLIENT_CHANGE_CUSTOM_LIKE,{custom_like:q.getPayload()}));}.bind(this)).send();};m.prototype.movePendingToInbox=function(n){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').MOVE_PENDING_TO_INBOX,c('MercuryPayloadSource').CLIENT_MOVE_PENDING_TO_INBOX));};m.prototype.updateSnippet=function(n,o){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').UPDATE_SNIPPET,c('MercuryPayloadSource').CLIENT_UPDATE_SNIPPET,{deleted_ids:o}));};m.prototype.$MercuryThreadActions2=function(n,o,p){return this.__constructClientPayload(n,c('MercuryActionType').CHANGE_READ_STATUS,c('MercuryPayloadSource').CLIENT_CHANGE_READ_STATUS,{mark_as_read:o,source:p});};m.prototype.$MercuryThreadActions3=function(n,o){return this.__constructClientPayload(n,c('MercuryActionType').CHANGE_ARCHIVED_STATUS,c('MercuryPayloadSource').CLIENT_CHANGE_ARCHIVED_STATUS,{archived:o});};m.prototype.$MercuryThreadActions4=function(n,o){return this.__constructClientPayload(n,c('MercuryActionType').CHANGE_FOLDER,c('MercuryPayloadSource').CLIENT_CHANGE_FOLDER,{new_folder:o});};m.prototype.__constructClientPayload=function(n,o,p,q){return {actions:n.map(function(r){return babelHelpers['extends']({action_type:o,thread_id:r},q);}),from_client:true,payload_source:p};};Object.assign(m,c('MercurySingletonMixin'));f.exports=m;}),null);
__d('ChatBehavior',['Arbiter','AvailableList','AvailableListConstants','ChatNotificationConstants'],(function a(b,c,d,e,f,g){var h=false,i=c('AvailableList').getWebChatNotification&&c('AvailableList').getWebChatNotification(),j=h,k=true,l=Object.assign(new (c('Arbiter'))(),{ON_CHANGED:'changed',notifiesUserMessages:function n(){return i!==c('ChatNotificationConstants').NO_USER_MESSAGE_NOTIFICATION;},ignoresRemoteTabRaise:function n(){return j;},showsTabUnreadUI:function n(){return k;}});function m(){l.inform(l.ON_CHANGED);}c('AvailableList').subscribe&&c('AvailableList').subscribe(c('AvailableListConstants').ON_CHAT_NOTIFICATION_CHANGED,function(){var n=i,o=c('AvailableList').getWebChatNotification();i=o;if(n!=o)m();});c('Arbiter').subscribe('chat/set_does_page_occlude_tabs',function(n,o){j=!!o;m();});c('Arbiter').subscribe('chat/set_show_tab_unread_ui',function(n,o){k=!!o;m();});f.exports=l;}),null);
__d('MessengerFluxReduceDispatcher',['ExplicitRegistrationReactDispatcher'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('ExplicitRegistrationReactDispatcher'));i=h&&h.prototype;function j(){h.apply(this,arguments);}f.exports=new j({strict:false});}),null);
__d('MessengerSharedMediaActions',['MessengerFluxReduceDispatcher','keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({CURRENT_LOADED:null,DELETE_PHOTOS:null,LATEST_LOADED:null,LOAD_CURRENT:null,LOAD_MORE_LATEST:null,LOAD_MORE_PREVIOUS:null,PREVIOUS_LOADED:null}),i='MessengerSharedMedia',j={Types:h,Namespace:i,currentLoaded:function k(l){c('MessengerFluxReduceDispatcher').dispatch({type:h.CURRENT_LOADED,namespace:i,data:l});},deletePhotos:function k(l,m){c('MessengerFluxReduceDispatcher').dispatch({type:h.DELETE_PHOTOS,namespace:i,threadFBID:l,photoFBIDs:m});},loadCurrent:function k(l,m){c('MessengerFluxReduceDispatcher').dispatch({type:h.LOAD_CURRENT,namespace:i,threadFBID:l,photoID:m});},loadMorePrevious:function k(l,m,n){c('MessengerFluxReduceDispatcher').dispatch({type:h.LOAD_MORE_PREVIOUS,namespace:i,threadFBID:l,afterCursor:m,first:n});},loadMoreLatest:function k(l,m,n){c('MessengerFluxReduceDispatcher').dispatch({type:h.LOAD_MORE_LATEST,namespace:i,threadFBID:l,beforeCursor:m,last:n});},previousLoaded:function k(l){c('MessengerFluxReduceDispatcher').dispatch({type:h.PREVIOUS_LOADED,namespace:i,data:l});},latestLoaded:function k(l){c('MessengerFluxReduceDispatcher').dispatch({type:h.LATEST_LOADED,namespace:i,data:l});}};f.exports=j;}),null);
__d('OmniMActions',['MessengerFluxReduceDispatcher','keyMirror','setImmediate'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({BAR_DISMISSED:null,BAR_DISPLAYED:null,BAR_DISAPPEARED:null,BAR_TIMED_OUT:null,MERCURY_DISPATCHED:null,FETCH_SUGGESTIONS:null,PREFS_UPDATED:null,SUGGESTION_CLICKED:null,SUGGESTION_COMPLETED:null,SUGGESTION_DISMISSED:null,SUGGESTION_DISPLAYED:null,SUGGESTION_DISAPPEARED:null,SUGGESTION_MODE_SET:null,SUGGESTIONS_DISMISSED_FOR_THREAD:null}),i='omnim',j={Types:h,Namespace:i,mercuryDispatched:function k(l,m){c('MessengerFluxReduceDispatcher').dispatch({type:h.MERCURY_DISPATCHED,namespace:i,mercuryType:l,data:m});},messageFetched:function k(l,m){c('setImmediate')(function(){c('MessengerFluxReduceDispatcher').dispatch({type:h.FETCH_SUGGESTIONS,namespace:i,threadID:l,message:m});});},suggestionClicked:function k(l,m,n,o){c('MessengerFluxReduceDispatcher').dispatch({type:h.SUGGESTION_CLICKED,namespace:i,threadID:l,option:m,source:n,position:o});},suggestionCompleted:function k(l,m,n,o){c('MessengerFluxReduceDispatcher').dispatch({type:h.SUGGESTION_COMPLETED,namespace:i,threadID:l,option:m,source:n,position:o});},suggestionDismissed:function k(l,m,n,o){c('MessengerFluxReduceDispatcher').dispatch({type:h.SUGGESTION_DISMISSED,namespace:i,threadID:l,option:m,source:n,position:o});},suggestionsDismissedForThread:function k(l){c('MessengerFluxReduceDispatcher').dispatch({type:h.SUGGESTIONS_DISMISSED_FOR_THREAD,namespace:i,threadID:l});},suggestionDisplayed:function k(l,m){c('setImmediate')(function(){c('MessengerFluxReduceDispatcher').dispatch({type:h.SUGGESTION_DISPLAYED,namespace:i,option:l,position:m});});},suggestionDisappeared:function k(l,m){c('setImmediate')(function(){c('MessengerFluxReduceDispatcher').dispatch({type:h.SUGGESTION_DISAPPEARED,namespace:i,option:l,position:m});});},prefsUpdated:function k(l){c('MessengerFluxReduceDispatcher').dispatch({type:h.PREFS_UPDATED,namespace:i,prefs:l});},suggestionModeSet:function k(l){c('MessengerFluxReduceDispatcher').dispatch({type:h.SUGGESTION_MODE_SET,namespace:i,mode:l});},barDismissed:function k(l){c('MessengerFluxReduceDispatcher').dispatch({type:h.BAR_DISMISSED,namespace:i,options:l});},barDisplayed:function k(l){c('setImmediate')(function(){c('MessengerFluxReduceDispatcher').dispatch({type:h.BAR_DISPLAYED,namespace:i,options:l});});},barDisappeared:function k(l){c('setImmediate')(function(){c('MessengerFluxReduceDispatcher').dispatch({type:h.BAR_DISAPPEARED,namespace:i,options:l});});},barTimedOut:function k(l,m){c('setImmediate')(function(){c('MessengerFluxReduceDispatcher').dispatch({type:h.BAR_TIMED_OUT,namespace:i,options:m,threadID:l});});}};f.exports=j;}),null);
__d('OmniMHelpers',['immutable','MercuryConfig'],(function a(b,c,d,e,f,g){function h(i){if(!c('MercuryConfig').OmniMEditConfidenceThreshold)return 0;if(i&&i.has('suggestion_mode')){var j=i.get('suggestion_mode');return j!==null&&j!==undefined?j:1;}return 3;}f.exports={suggestionMode:h};}),null);
__d('MNOmniMConstants',['keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({OMNIM:null,QUICKREPLIES:null});h.SUGGESTION_MODES=['conservative','balanced','aggressive','muted'];f.exports=h;}),null);
__d('OmniMLogHelpers',['OmniMEventTypedLogger','MNOmniMConstants','OmniMLoggerEvents','CurrentUser'],(function a(b,c,d,e,f,g){function h(s){return c('MNOmniMConstants').SUGGESTION_MODES[s];}function i(s,t,u,v){new (c('OmniMEventTypedLogger'))().setEventName(s).setPosition(u+'').setMessageID(t.messageID).setPigeonID(t.suggestionID).setSuggestionMode(h(v)).setContextUserID(c('CurrentUser').getID()).setConfidence(Math.round(t.confidence*10000)).log();}function j(s,t,u){new (c('OmniMEventTypedLogger'))().setEventName(s).setSuggestionMode(h(u)).setContextUserID(c('CurrentUser').getID()).setSuggestionIds(t.map(function(v){return v.suggestionID;})).log();}function k(s,t,u){i(c('OmniMLoggerEvents').SUGGESTION_DISPLAYED,s,t,u);}function l(s,t,u){i(c('OmniMLoggerEvents').SUGGESTION_DISAPPEARED,s,t,u);}function m(s,t,u){i(c('OmniMLoggerEvents').SUGGESTION_DISMISSED,s,t,u);}function n(s,t,u){i(c('OmniMLoggerEvents').SUGGESTION_CLICKED,s,t,u);}function o(s,t,u){i(c('OmniMLoggerEvents').SUGGESTION_COMPLETED,s,t,u);}function p(s,t){j(c('OmniMLoggerEvents').BAR_DISAPPEARED,s,t);}function q(s,t){j(c('OmniMLoggerEvents').BAR_DISMISSED,s,t);}function r(s,t){j(c('OmniMLoggerEvents').BAR_DISPLAYED,s,t);}f.exports={barDisappeared:p,barDisplayed:r,barDismissed:q,suggestionDisplayed:k,suggestionDisappeared:l,suggestionDismissed:m,suggestionClicked:n,suggestionCompleted:o};}),null);
__d("XMessagingOmniMSetPrefController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/set_omnim_prefs\/",{});}),null);
__d('OmniMReducer',['AsyncRequest','immutable','MercuryActionType','MercuryConfig','MercuryIDs','MercuryPayloadSource','MNOmniMConstants','OmniMActions','OmniMActionType','OmniMDirectiveType','OmniMLogHelpers','P2PGKValues','XMessagingOmniMSetPrefController'],(function a(b,c,d,e,f,g){'use strict';var h,i=c('OmniMActions').Types,j=c('immutable').Set([c('MercuryActionType').SEND_MESSAGE,c('MercuryActionType').REPLACE_MESSAGE,c('MercuryActionType').USER_GENERATED_MESSAGE]),k=c('immutable').Set([c('MercuryActionType').SEND_MESSAGE,c('MercuryActionType').USER_GENERATED_MESSAGE]),l=2;function m(oa,pa){switch(oa.content_type){case 'text':return true;case 'location':if(pa===c('MNOmniMConstants').OMNIM)return c('MercuryConfig').OmniMLocationSuggestion;return c('MercuryConfig').MessengerLocationQuickReply;case 'sticker':return c('MercuryConfig').MessengerStickerQuickReply;case 'ride_service':return c('MercuryConfig').MessengerRideServiceQuickReply;case 'p2p_payment':return c('P2PGKValues').P2PVisible&&c('MercuryConfig').MessengerP2PPaymentQuickReply;default:return false;}}function n(oa){return Array.isArray(oa);}function o(oa){if(!oa)return {};var pa=JSON.parse(oa)||{},qa=n(pa.quick_replies)?pa.quick_replies:[],ra=pa.m_directives;return {quickReplies:qa,directives:ra};}function p(oa){var pa=oa.other_user_fbid,qa=oa.thread_fbid;return pa?c('MercuryIDs').getThreadIDFromUserID(pa):c('MercuryIDs').getThreadIDFromThreadFBID(qa);}var q=c('immutable').Map((h={},h[c('OmniMActionType').CREATE_EVENT]='create_event',h[c('OmniMActionType').LOCATION]='location',h[c('OmniMActionType').PAYMENT]='p2p_payment',h[c('OmniMActionType').POLL]='poll',h[c('OmniMActionType').STICKER]='sticker',h[c('OmniMActionType').TEXT]='text',h[c('OmniMActionType').TRANSPORTATION]='ride_service',h[c('OmniMActionType').ORDER_FOOD]='order_food',h[c('OmniMActionType').MAKE_RESERVATION]='make_reservation',h[c('OmniMActionType').SCHEDULE_CALL]='schedule_call',h[c('OmniMActionType').LIVE_LOCATION]='live_location',h));function r(oa){var pa=oa.confidence,qa=oa.id,ra=oa.label,sa=oa.type,ta=oa.data,ua=oa.icon,va=oa.message_id,wa=oa.thread_key;return {content_type:q.get(sa+''),data:ta,image_url:ua,title:ra,confidence:pa,messageID:va,suggestionID:qa,threadID:p(wa),messageDepth:1};}function s(oa,pa){var qa=o(pa),ra=(qa.quickReplies||[]).filter(function(ta){return m(ta,c('MNOmniMConstants').QUICKREPLIES);}),sa=(qa.directives||[]).filter(function(ta){return ta.type===c('OmniMDirectiveType').ADD_ACTIONS;}).map(function(ta){return ta.data.actions;}).reduce(function(ta,ua){return ta.concat(ua);},[]).map(r).filter(function(ta){return m(ta,c('MNOmniMConstants').OMNIM);}).reduce(function(ta,ua){var va=ua.threadID;return ta.updateIn([va,'agentSuggestions'],[],function(wa){return wa.concat([ua]);});},c('immutable').Map({}));return sa.setIn([oa,'quickReplies'],ra);}function t(oa){var pa=oa.content_type;Object.keys(oa.data||{}).sort().map(function(qa){pa+=''+qa+oa.data[qa];});return pa;}function u(oa){var pa=c('immutable').Set(),qa=[];for(var ra=oa.length-1;ra>=0;ra--){var sa=oa[ra],ta=t(sa);if(!pa.has(ta)){pa=pa.add(ta);qa.unshift(sa);}}return qa;}function v(oa){var pa=0;return oa.filter(function(qa){if(qa.content_type==='sticker'){if(pa>=l)return false;pa+=1;}return true;});}function w(oa,pa,qa,ra){var sa=oa.getIn(['threadMetadata',pa,'timestamp']);if(sa&&sa>ra)return oa;var ta=qa.agentSuggestions,ua=qa.quickReplies,va=(oa.getIn(['suggestionsByThread',pa])||{}).agentSuggestions||[],wa=ta||[];if(va.length)wa=v(wa);var xa=u(wa.concat(va));return oa.setIn(['threadMetadata',pa,'timestamp'],ra).setIn(['suggestionsByThread',pa],{agentSuggestions:xa,quickReplies:ua});}function x(oa,pa,qa,ra,sa){var ta=s(pa,ra);return ta.reduce(function(ua,va,wa){return w(ua,wa,va.toJS(),sa);},oa);}function y(oa){if(!oa)return null;var pa=oa.agentSuggestions,qa=(pa||[]).reduce(function(ra,sa){if(sa.messageDepth>=c('MercuryConfig').OmniMMessagesToLive)return ra;return ra.concat([babelHelpers['extends']({},sa,{messageDepth:sa.messageDepth+1})]);},[]);return babelHelpers['extends']({},oa,{agentSuggestions:qa});}function z(oa,pa){var qa=pa.thread_id,ra=pa.message_id,sa=pa.platform_xmd,ta=pa.timestamp;if(k.has(pa.action_type))oa=oa.updateIn(['suggestionsByThread',qa],y);return x(oa,qa,ra,sa,ta);}function aa(oa,pa){if(pa.type!==i.MERCURY_DISPATCHED)return oa;var qa=pa.data;switch(pa.mercuryType){case 'update-messages':if(qa.payload_source!==c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE)return oa;return qa.actions.filter(function(ra){return j.has(ra.action_type);}).reduce(z,oa);case 'invalidate-thread-state':return oa.deleteIn(['suggestionsByThread',qa.threadID]).deleteIn(['threadMetadata',qa.threadID]);case 'invalidate-global-state':return oa.set('suggestionsByThread',c('immutable').Map()).set('threadMetadata',c('immutable').Map());}return oa;}function ba(oa,pa){if(pa.type!==i.FETCH_SUGGESTIONS)return oa;var qa=pa.message,ra=pa.threadID;return x(oa,ra,qa.message_id,qa.platform_xmd,qa.timestamp);}function ca(oa){return oa.getIn(['prefs','suggestion_mode'],0);}function da(oa,pa){if(pa.type!==i.SUGGESTION_CLICKED)return oa;var qa=pa.option,ra=pa.position,sa=pa.source;if(sa===c('MNOmniMConstants').OMNIM)c('OmniMLogHelpers').suggestionClicked(qa,ra,ca(oa));return oa;}function ea(oa,pa){if(pa.type!==i.SUGGESTION_COMPLETED)return oa;var qa=pa.threadID,ra=pa.option,sa=pa.position,ta=pa.source;if(ta===c('MNOmniMConstants').OMNIM)c('OmniMLogHelpers').suggestionCompleted(ra,sa,ca(oa));return oa.deleteIn(['suggestionsByThread',qa]);}function fa(oa,pa){if(pa.type!==i.SUGGESTION_DISMISSED)return oa;var qa=pa.threadID,ra=pa.option,sa=pa.source,ta=pa.position;if(sa===c('MNOmniMConstants').OMNIM)c('OmniMLogHelpers').suggestionDismissed(ra,ta,ca(oa));var ua=oa.getIn(['suggestionsByThread',qa]);if(!ua||!ua.agentSuggestions)return oa;var va=ua.agentSuggestions.map(function(wa){if(wa.suggestionID===ra.suggestionID)return babelHelpers['extends']({},wa,{dismissed:true});return wa;});return oa.setIn(['suggestionsByThread',qa],babelHelpers['extends']({},ua,{agentSuggestions:va}));}function ga(oa,pa){if(pa.type!==i.SUGGESTIONS_DISMISSED_FOR_THREAD)return oa;var qa=pa.threadID,ra=oa.getIn(['suggestionsByThread',qa]);if(!ra||!ra.agentSuggestions)return oa;c('OmniMLogHelpers').barDismissed(ra.agentSuggestions,ca(oa));var sa=ra.agentSuggestions.map(function(ta,ua){if(ta.dismissed)return ta;c('OmniMLogHelpers').suggestionDismissed(ta,ua,ca(oa));return babelHelpers['extends']({},ta,{dismissed:true});});return oa.setIn(['suggestionsByThread',qa],babelHelpers['extends']({},ra,{agentSuggestions:sa}));}function ha(oa,pa){if(pa.type!==i.PREFS_UPDATED)return oa;var qa=pa.prefs;return oa.updateIn(['prefs'],function(ra){return ra.merge(c('immutable').fromJS(qa));});}function ia(oa,pa){if(pa.type!==i.SUGGESTION_MODE_SET)return oa;var qa=pa.mode,ra=c('XMessagingOmniMSetPrefController').getURIBuilder().getURI();new (c('AsyncRequest'))(ra).setMethod('POST').setData({suggestion_mode:qa}).send();return oa.setIn(['prefs','suggestion_mode'],qa);}function ja(oa,pa){if(pa.type!==i.SUGGESTION_DISPLAYED)return oa;var qa=pa.option,ra=pa.position;if(!qa.dismissed)c('OmniMLogHelpers').suggestionDisplayed(qa,ra,ca(oa));return oa;}function ka(oa,pa){if(pa.type!==i.SUGGESTION_DISAPPEARED)return oa;var qa=pa.option,ra=pa.position;if(!qa.dismissed)c('OmniMLogHelpers').suggestionDisappeared(qa,ra,ca(oa));return oa;}function la(oa,pa){if(pa.type!==i.BAR_TIMED_OUT)return oa;var qa=pa.threadID,ra=pa.options;c('OmniMLogHelpers').barDisappeared(ra,ca(oa));return oa.deleteIn(['suggestionsByThread',qa]);}function ma(oa,pa){if(pa.type!==i.BAR_DISAPPEARED)return oa;c('OmniMLogHelpers').barDisappeared(pa.options,ca(oa));return oa;}function na(oa,pa){if(pa.type!==i.BAR_DISPLAYED)return oa;c('OmniMLogHelpers').barDisplayed(pa.options,ca(oa));return oa;}f.exports={barDisappeared:ma,barDisplayed:na,barTimedOut:la,mercuryDispatch:aa,messageFetched:ba,prefsUpdated:ha,suggestionClicked:da,suggestionCompleted:ea,suggestionDisappeared:ka,suggestionDismissed:fa,suggestionDisplayed:ja,suggestionModeSet:ia,suggestionsDismissedForThread:ga};}),null);
__d('OmniMState',['immutable'],(function a(b,c,d,e,f,g){'use strict';var h,i,j={suggestionsByThread:c('immutable').Map(),threadMetadata:c('immutable').Map(),prefs:c('immutable').Map()};h=babelHelpers.inherits(k,c('immutable').Record(j));i=h&&h.prototype;function k(){h.apply(this,arguments);}f.exports=k;}),null);
__d('MercuryMessages',['invariant','BanzaiODS','ChatReliabilityInstrumentation','EventEmitter','ImmutableObject','LogHistory','Map','MercuryActionStatus','MercuryActionType','MercuryAssert','MercuryAttachment','MercuryDispatcher','MercuryIDs','MercuryLogMessageType','MercuryMessageClientState','MercuryPayloadSource','MercurySingletonProvider','MercuryMessageActions','MercuryMessageIDs','MessagingGiftWrapConstants','MessengerSharedMediaActions','RangedCallbackManager','MercurySendMessageFields','MercuryServerRequests','MercuryThreadActions','MercuryThreadInformer','MercuryThreads','URI','isMessengerDotComURI','setImmediate'],(function a(b,c,d,e,f,g,h){'use strict';var i=new (c('EventEmitter'))(),j=c('LogHistory').getInstance('mercury_messages');function k(p){switch(p){case c('MercuryPayloadSource').UNKNOWN:case c('MercuryPayloadSource').SERVER_INITIAL_DATA:case c('MercuryPayloadSource').SERVER_FETCH_THREAD_INFO:case c('MercuryPayloadSource').SERVER_THREAD_SYNC:return true;}return false;}l.getForFBID=function(p){return o.getForFBID(p);};l.get=function(){return o.get();};function l(p){this.$MercuryMessages1=p;this.$MercuryMessages2=c('MercuryMessageActions').getForFBID(this.$MercuryMessages1);this.$MercuryMessages3=c('MercuryServerRequests').getForFBID(this.$MercuryMessages1);this.$MercuryMessages4=c('MercuryThreadInformer').getForFBID(this.$MercuryMessages1);this.$MercuryMessages5=c('MercuryThreads').getForFBID(this.$MercuryMessages1);this.$MercuryMessages6=c('MercuryThreadActions').getForFBID(this.$MercuryMessages1);this.$MercuryMessages7=c('MercuryDispatcher').getForFBID(this.$MercuryMessages1);this.$MercuryMessages8=false;this.$MercuryMessages9={};this.$MercuryMessages10={};this.$MercuryMessages11={};this.$MercuryMessages12=new (c('Map'))();this.$MercuryMessages13={};this.$MercuryMessages14={};this.$MercuryMessages7.subscribe('update-messages',function(q,r){var s=(r.actions||[]).filter(function(u){var v=u.action_type,w=u.thread_id&&(v==c('MercuryActionType').LOG_MESSAGE||v==c('MercuryActionType').USER_GENERATED_MESSAGE||v==c('MercuryActionType').SEND_MESSAGE||v==c('MercuryActionType').DELETE_THREAD||v==c('MercuryActionType').DELETE_MESSAGES),x=u.upload_id&&u.upload_data&&(v==c('MercuryActionType').CANCEL_ATTACHMENT_PLACEHOLDER||v==c('MercuryActionType').CONFIRM_ATTACHMENT_PLACEHOLDER),y=v==c('MercuryActionType').REACTION_UPDATE,z=u.replaced_message_id&&v==c('MercuryActionType').REPLACE_MESSAGE,aa=u.unwrapped_message_id&&v==c('MercuryActionType').UNWRAP_MESSAGE;return w||x||y||z||aa;}),t=k(r.payload_source);this.handleUpdates(s,t,r.payload_source,r.from_client);if(r.end_of_history)this.$MercuryMessages15(r.end_of_history,r.payload_source);if(this.$MercuryMessages8){this.$MercuryMessages8=false;i.emit('change');}}.bind(this));this.$MercuryMessages7.subscribe('invalidate-thread-state',function(q,r){this.$MercuryMessages16(r);}.bind(this));this.$MercuryMessages7.subscribe('invalidate-global-state',function(){return this.invalidateGlobalState();}.bind(this));j.debug('constructed',JSON.stringify({fbid:this.$MercuryMessages1}));}l.prototype.getMessagesFromIDs=function(p){return (p||[]).map(function(q){return this.$MercuryMessages17(q);}.bind(this)).filter(function(q){return q;});};l.prototype.getServerMessageID=function(p){var q=p;if(this.$MercuryMessages13[p])q=this.$MercuryMessages13[p];return q;};l.prototype.hasLoadedNMessages=function(p,q){var r=this.$MercuryMessages18(p);return r.hasReachedEndOfArray()||r.getCurrentArraySize()>=q;};l.prototype.hasLoadedExactlyNMessages=function(p,q){var r=this.$MercuryMessages18(p);return r.getCurrentArraySize()==q;};l.prototype.invalidateGlobalState=function(){var p=Object.keys(this.$MercuryMessages10);this.$MercuryMessages9={};this.$MercuryMessages10={};this.$MercuryMessages11={};this.$MercuryMessages12=new (c('Map'))();this.$MercuryMessages13={};p.map(function(q){return this.$MercuryMessages4.invalidatedThread(q);}.bind(this));};l.prototype.getThreadMessagesRange=function(p,q,r,s,t,u){var v=this.$MercuryMessages18(p),w=function(ga){s(this.$MercuryMessages19(ga));}.bind(this),x=v.executeOrEnqueue(q,r,w),y=v.getUnavailableResources(x),z=this.$MercuryMessages9[p];if(y.length&&!z){var aa=v.getCurrentArraySize(),ba=this.$MercuryMessages11[p]||0,ca=aa-ba,da=y.length+ba,ea=this.getCurrentlyLoadedMessages(p),fa=ea.length?ea[0].timestamp:null;j.debug('fetch_missing_messages',JSON.stringify({threadID:p,offset:q,limit:r,timestamp:fa,missingIndices:y,messageCount:aa,localMessageCount:ba}));this.$MercuryMessages3.fetchThreadMessages(p,ca,da,fa,t,u);}else this.$MercuryMessages9[p]=false;return x;};l.prototype.getThreadMessagesRangeNow=function(p,q,r){var s=this.$MercuryMessages18(p),t=[];for(var u=q;u<q+r;u++){var v=s.getResourceAtIndex(u),w=v&&this.$MercuryMessages17(v);w&&t.push(w);}return t;};l.prototype.getThreadMessagesSinceTimestamp=function(p,q){var r=this.$MercuryMessages18(p),s=r.getElementsUntil(q);return this.$MercuryMessages19(s);};l.prototype.hasLoadedAllMessages=function(p){return this.$MercuryMessages18(p).hasReachedEndOfArray();};l.prototype.getCurrentlyLoadedMessages=function(p){var q=this.$MercuryMessages18(p).getAllResources();return this.$MercuryMessages19(q);};l.prototype.unsubscribe=function(p,q){c('MercuryAssert').isThreadID(q);var r=this.$MercuryMessages18(q);r.unsubscribe(p);};l.prototype.$MercuryMessages20=function(p,q){n(q);this.$MercuryMessages12.set(p,new (c('ImmutableObject'))(q));};l.prototype.$MercuryMessages21=function(p,q){var r=this.$MercuryMessages12.get(p);if(r){var s=r.page_admin_notes?r.page_admin_notes.slice():[],t=false,u=true;for(var v=0;v<s.length;++v)if(s[v].id===q.id){t=true;u=false;break;}else if((s[v].id===null||s[v].id===undefined)&&s[v].body===q.body){t=true;s[v]=q;}if(!t)s.push(q);if(u){var w={};w.page_admin_notes=s;this.$MercuryMessages22(p,r,w);}}};l.prototype.$MercuryMessages22=function(p,q,r){var s=c('ImmutableObject').set(q,r);this.$MercuryMessages12.set(p,s);return s;};l.prototype.$MercuryMessages23=function(p,q,r){if(p==c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE){var s=this.getThreadMessagesSinceTimestamp(q,r);if(s.length>0){c('BanzaiODS').bumpEntityKey('chat.web','channel.messages_reordered');return true;}}else if(p===c('MercuryPayloadSource').SERVER_INVALIDATE_THREAD_STATE||p===c('MercuryPayloadSource').SERVER_INVALIDATE_GLOBAL_STATE)return true;return false;};l.prototype.$MercuryMessages24=function(p,q){var r=p.action_type;if(q==c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE&&r==c('MercuryActionType').USER_GENERATED_MESSAGE&&p.offline_threading_id&&this.$MercuryMessages13[p.offline_threading_id]===p.offline_threading_id){p.client_message_id=p.offline_threading_id;p.status=c('MercuryActionStatus').SUCCESS;p.action_type=c('MercuryActionType').SEND_MESSAGE;r=p.action_type;}if(q===c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE&&r==c('MercuryActionType').USER_GENERATED_MESSAGE){var s=this.$MercuryMessages5.getThreadMetaNow(p.thread_id);if(s&&s.folder)p.folder=s.folder;c('ChatReliabilityInstrumentation').logMESSAGE_RECEIVED();}return p;};l.prototype.handleUpdates=function(p,q,r,s){var t=void 0,u={};for(var v=0;v<p.length;v++){var w=this.$MercuryMessages24(p[v],r),x=w.action_type,y=w.message_id?this.$MercuryMessages17(w.message_id):null;if(x==c('MercuryActionType').LOG_MESSAGE)if(this.isLocalMessage(w))continue;if(r==c('MercuryPayloadSource').SERVER_SEARCH){if(!this.$MercuryMessages12.has(w.message_id))this.$MercuryMessages20(w.message_id,w);continue;}else if(w.client_state===c('MercuryMessageClientState').SEND_TO_SERVER){this.$MercuryMessages20(w.message_id,w);continue;}else if(x==c('MercuryActionType').SEND_MESSAGE){var z=w.client_message_id,aa=this.$MercuryMessages17(z);if(z&&aa&&w.status){var ba=aa.status;if(aa.status==c('MercuryActionStatus').SUCCESS)continue;if(!u[w.thread_id])u[w.thread_id]=[];this.$MercuryMessages25(w);if(typeof ba!==undefined||w.status==c('MercuryActionStatus').FAILED_UNKNOWN_REASON||w.status==c('MercuryActionStatus').UNABLE_TO_CONFIRM||w.status==c('MercuryActionStatus').SUCCESS||w.status==c('MercuryActionStatus').ERROR){var ca=this.$MercuryMessages17(z);if(ca)this.$MercuryMessages26(w.thread_id,ca.message_id,r);}}continue;}else if(x==c('MercuryActionType').DELETE_THREAD){this.$MercuryMessages18(w.thread_id).removeAllResources();continue;}else if(x==c('MercuryActionType').DELETE_MESSAGES){this.$MercuryMessages27(w.thread_id,w.message_ids,r);c('setImmediate')(function(){this.$MercuryMessages6.updateSnippet(w.thread_id,w.message_ids);}.bind(this));continue;}else if(x===c('MercuryActionType').REACTION_UPDATE){if(this.$MercuryMessages28(w))this.$MercuryMessages29(u,w,r);continue;}else if(x==c('MercuryActionType').REPLACE_MESSAGE){if(this.$MercuryMessages30(w)){this.$MercuryMessages29(u,w,r);q=true;}continue;}else if(w.offline_threading_id&&this.$MercuryMessages13[w.offline_threading_id]&&(r!=c('MercuryPayloadSource').SERVER_FETCH_THREAD_INFO||this.$MercuryMessages13[w.offline_threading_id]===w.message_id)||y){if(y&&w.ranges&&w.ranges.length>0){var da=y.message_id;this.$MercuryMessages22(this.$MercuryMessages13[da]||da,y,{ranges:w.ranges});this.$MercuryMessages26(y.thread_id,y.message_id,'link_shim');}continue;}else if(x===c('MercuryActionType').CONFIRM_ATTACHMENT_PLACEHOLDER){this.$MercuryMessages31(w.upload_id,w.upload_data);continue;}else if(x===c('MercuryActionType').CANCEL_ATTACHMENT_PLACEHOLDER){this.$MercuryMessages32(w.upload_id,w.upload_data);continue;}else if(x==c('MercuryActionType').UNWRAP_MESSAGE){if(this.$MercuryMessages33(w))this.$MercuryMessages26(w.thread_id,w.unwrapped_message_id,r);}else{if(r===c('MercuryPayloadSource').CLIENT_SEND_MESSAGE){this.$MercuryMessages13[w.message_id]=w.message_id;if(w.thread_id=='root:'+w.offline_threading_id)this.$MercuryMessages18(w.thread_id).setReachedEndOfArray();}if(x==c('MercuryActionType').LOG_MESSAGE&&w.log_message_type==c('MercuryLogMessageType').SERVER_ERROR)this.$MercuryMessages9[w.thread_id]=true;if(w.client_state===c('MercuryMessageClientState').DO_NOT_SEND_TO_SERVER&&w.upload_id)this.$MercuryMessages14[w.upload_id]=w;if(!u[w.thread_id])u[w.thread_id]=[];u[w.thread_id].push(w.message_id);this.$MercuryMessages20(w.message_id,w);if(w.offline_threading_id&&w.offline_threading_id!=w.message_id){this.$MercuryMessages13[w.offline_threading_id]=w.message_id;c('MercuryMessageIDs').addServerID(w.offline_threading_id,w.message_id);if(w.threading_id)c('MercuryMessageIDs').addServerID(w.threading_id,w.message_id);}if(w[c('MercurySendMessageFields').MANUAL_RETRY_CNT]>0){t=this.$MercuryMessages18(w.thread_id);t.resortResources([w.message_id]);this.$MercuryMessages34(w.thread_id,c('MercuryPayloadSource').CLIENT_SEND_MESSAGE);}q=q||this.$MercuryMessages23(r,w.thread_id,w.timestamp);if(!q){var ea=this.$MercuryMessages17(w.message_id);if(ea)this.$MercuryMessages35(ea);}continue;}}for(var fa in u){t=this.$MercuryMessages18(fa);var ga=t.getAllResources(),ha=ga.filter(function(ia){var ja=this.$MercuryMessages12.get(ia);if(!ja)return true;return ja.action_type==c('MercuryActionType').LOG_MESSAGE&&ja.log_message_type==c('MercuryLogMessageType').SERVER_ERROR;}.bind(this));t.removeResources(ha);if(s)this.$MercuryMessages36(fa,u[fa]);if(q){t.addResources(u[fa]);this.$MercuryMessages34(fa,r);}else t.addResourcesWithoutSorting(u[fa].reverse(),0);this.$MercuryMessages4.updatedThread(fa);}this.$MercuryMessages8&&j.debug('handle_updates',JSON.stringify({localMessageCounts:this.$MercuryMessages11}));};l.prototype.$MercuryMessages29=function(p,q,r){if(!p[q.thread_id])p[q.thread_id]=[];this.$MercuryMessages18(q.thread_id).removeResources([q.replaced_message_id,q.offline_threading_id]);p[q.thread_id].push(q.message_id);if(q.replaced_message_id)this.$MercuryMessages26(q.thread_id,q.replaced_message_id,r);this.$MercuryMessages26(q.thread_id,q.message_id||q.messageId,r);};l.prototype.isFirstMessage=function(p){var q=this.$MercuryMessages18(p.thread_id);if(q.getCurrentArraySize()===0)return false;var r=q.getResourceAtIndex(q.getCurrentArraySize()-1),s=this.$MercuryMessages17(r),t=s&&s.message_id,u=this.$MercuryMessages17(p.message_id),v=u&&u.message_id;if(!t||!v)return false;return q.hasReachedEndOfArray()&&t==v;};l.prototype.isLocalMessage=function(p){if(p.offline_threading_id!==null&&p.offline_threading_id===p.message_id)return true;return false;};l.prototype.$MercuryMessages27=function(p,q,r){if(!q.length)return;this.$MercuryMessages37(p,q,r);if(r!==c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE)this.$MercuryMessages3.deleteMessages(p,q);var s=this.$MercuryMessages19(q);for(var t=0;t<s.length;t++){var u=s[t];if(u&&u.has_attachment){var v=u.attachments.map(function(w){if(c('MercuryAttachment').isPhotoAttachment(w)||c('MercuryAttachment').isVideoAttachment(w))return w.metadata.fbid;return null;}).filter(function(w){return w!==null;});c('MessengerSharedMediaActions').deletePhotos(c('MercuryIDs').getThreadFBIDFromThreadID(u.thread_id),v);}}};l.prototype.$MercuryMessages37=function(p,q,r){var s=q.map(function(u){var v=this.$MercuryMessages17(u);return v&&v.message_id;}.bind(this)).filter(function(u){return !!u;}),t=this.$MercuryMessages18(p);t.removeResources(s);this.$MercuryMessages34(p,r);};l.prototype.$MercuryMessages25=function(p){var q=p.client_message_id;if(!q)return false;var r=this.$MercuryMessages17(q);if(!r)return false;var s={};s.status=p.status;if(p.status===c('MercuryActionStatus').SUCCESS||p.error_data)s.error_data=p.error_data;var t=p.message_id;if(this.$MercuryMessages12.has(t)){if(r)this.$MercuryMessages22(t,r,s);return false;}if(p.threading_id)s.threading_id=p.threading_id;if(p.timestamp)s.timestamp=p.timestamp;if(p.log_message_data)s.log_message_data=p.log_message_data;if(p.ranges&&p.ranges.length){n(p);s.ranges=p.ranges;}if(p.attachments&&p.attachments.length){s.raw_attachments=null;s.attachments=p.attachments;}this.$MercuryMessages13[q]=t;c('MercuryMessageIDs').addServerID(q,t);if(r){var u=this.$MercuryMessages22(t,r,s);this.$MercuryMessages12.set(q,new (c('ImmutableObject'))());if(m(u))this.$MercuryMessages11[u.thread_id]--;}return true;};l.prototype.$MercuryMessages28=function(p){var q,r=p.messageId,s=p.reaction,t=p.userId,u=this.$MercuryMessages17(r);if(!u)return false;var v=babelHelpers['extends']({},u.reactions,(q={},q[t]=s,q));if(!s)delete v[t];this.$MercuryMessages22(r,u,{reactions:v});return true;};l.prototype.$MercuryMessages30=function(p){var q=p.replaced_message_id;if(!q)return false;var r=this.$MercuryMessages17(q);if(!r)return false;var s=p.message_id,t={};if(p.status)t.status=p.status;if(p.timestamp&&s!==q)t.timestamp=p.timestamp;if(p.log_message_data)t.log_message_data=p.log_message_data;if(p.ranges&&p.ranges.length){n(p);t.ranges=p.ranges;}if(p.meta_ranges)t.meta_ranges=p.meta_ranges;if(p.attachments&&p.attachments.length){t.raw_attachments=null;t.attachments=p.attachments;}if(p.body&&p.body!==r.body)t.body=p.body;if(p.platform_xmd&&p.platform_xmd!==r.platform_xmd)t.platform_xmd=p.platform_xmd;if(p.profile_ranges&&p.profile_ranges!==r.profile_ranges)t.profile_ranges=p.profile_ranges;if(Object.keys(t).length===0)return false;c('MercuryMessageIDs').addServerID(s,s);this.$MercuryMessages22(s,r,t);if(q!==s){this.$MercuryMessages12['delete'](q);if(r.message_id&&this.$MercuryMessages12.has(r.message_id))this.$MercuryMessages12['delete'](r.message_id);}return true;};l.prototype.$MercuryMessages33=function(p){var q=this.$MercuryMessages17(p.unwrapped_message_id);if(!q||!q.tags)return false;var r=q.tags.slice(0);r.push(c('MessagingGiftWrapConstants').UNWRAPPED_TAG);var s={tags:r};this.$MercuryMessages22(p.unwrapped_message_id,q,s);return true;};l.prototype.getNumberLocalMessages=function(p){return this.$MercuryMessages11[p]||0;};l.prototype.$MercuryMessages31=function(p,q){var r=this.$MercuryMessages38(p,q);delete r.preview_attachments;this.$MercuryMessages3.sendNewMessage(r);};l.prototype.$MercuryMessages32=function(p,q){var r=this.$MercuryMessages38(p,q);this.$MercuryMessages37(r.thread_id,[r.message_id]);if(this.$MercuryMessages11[r.thread_id])this.$MercuryMessages11[r.thread_id]--;};l.prototype.$MercuryMessages38=function(p,q){var r=this.$MercuryMessages14[p];r||h(0);r.image_ids=q.image_ids;r.file_ids=q.file_ids;r.audio_ids=q.audio_ids;r.gif_ids=q.gif_ids;r.video_ids=q.video_ids;r.client_state=c('MercuryMessageClientState').SEND_TO_SERVER;delete this.$MercuryMessages14[p];return r;};l.prototype.$MercuryMessages26=function(p,q,r){this.$MercuryMessages8=true;this.$MercuryMessages4.updatedMessage(p,q,r);};l.prototype.$MercuryMessages35=function(p){this.$MercuryMessages8=true;this.$MercuryMessages4.receivedMessage(p);};l.prototype.$MercuryMessages34=function(p,q){this.$MercuryMessages8=true;this.$MercuryMessages4.reorderedMessages(p,q);};l.prototype.$MercuryMessages16=function(p){if(!this.$MercuryMessages10[p])return;var q=this.$MercuryMessages10[p].getAllResources();q.forEach(function(r){var s=this.$MercuryMessages17(r),t=undefined;if(s)t=s.offline_threading_id;this.$MercuryMessages12['delete'](r);if(t){var u=this.$MercuryMessages13[t];if(u)this.$MercuryMessages12['delete'](u);delete this.$MercuryMessages13[t];}delete this.$MercuryMessages13[r];}.bind(this));delete this.$MercuryMessages10[p];};l.addListener=function(p,q){return i.addListener(p,q);};l.prototype.$MercuryMessages17=function(p){var q=p;if(this.$MercuryMessages13[p])q=this.$MercuryMessages13[p];return this.$MercuryMessages12.get(q);};l.prototype.$MercuryMessages18=function(p){if(!this.$MercuryMessages10[p])this.$MercuryMessages10[p]=new (c('RangedCallbackManager'))(function(q){var r=this.$MercuryMessages17(q);return r&&r.timestamp;}.bind(this),function(q,r){return r-q;});return this.$MercuryMessages10[p];};l.prototype.$MercuryMessages15=function(p,q){p.forEach(function(r){var s=this.$MercuryMessages18(r);s.setReachedEndOfArray();this.$MercuryMessages34(r,q);}.bind(this));};l.prototype.$MercuryMessages19=function(p){var q=p.reduce(function(r,s){var t=this.$MercuryMessages17(s);if(t)r.push(t);return r;}.bind(this),[]);return q.reverse();};l.prototype.$MercuryMessages36=function(p,q){var r=q.filter(function(s){return m(this.$MercuryMessages17(s));}.bind(this));if(!this.$MercuryMessages11[p])this.$MercuryMessages11[p]=0;this.$MercuryMessages11[p]+=r.length;};function m(p){var q=p.action_type;if(q==c('MercuryActionType').USER_GENERATED_MESSAGE)return true;switch(p.log_message_type){case c('MercuryLogMessageType').SUBSCRIBE:case c('MercuryLogMessageType').UNSUBSCRIBE:case c('MercuryLogMessageType').SERVER_ERROR:case c('MercuryLogMessageType').LIVE_LISTEN:return false;default:return true;}}function n(p){if(!p.ranges)return;p.ranges.forEach(function(q){if(!q.entity||q.entity.external||!q.entity.url)return;var r=new (c('URI'))(q.entity.url);if(c('isMessengerDotComURI')(c('URI').getRequestURI())&&!r.getDomain()){r.setProtocol('https').setDomain('www.facebook.com');q.entity.url=r.toString();}});}var o=new (c('MercurySingletonProvider'))(l);f.exports=l;}),null);
__d("XMessagingOmniMPrefController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/get_omnim_prefs\/",{});}),null);
__d('OmniMStore',['AsyncRequest','FluxReduceStore','immutable','MercuryConfig','MercuryDispatcher','MercuryMessages','MessengerFluxReduceDispatcher','OmniMHelpers','OmniMReducer','OmniMState','OmniMActions','XMessagingOmniMPrefController'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=5,k=[].concat(Object.values(c('OmniMReducer')));h=babelHelpers.inherits(l,c('FluxReduceStore'));i=h&&h.prototype;l.prototype.getInitialState=function(){return new (c('OmniMState'))();};l.prototype.reduce=function(m,n){if(n.namespace!==c('OmniMActions').Namespace)return m;return k.reduce(function(o,p){return p(o,n);},m);};l.prototype.$OmniMStore1=function(m){c('MercuryMessages').get().getThreadMessagesRange(m,0,1,function(n){if(n&&n.length){var o=n[0];c('OmniMActions').messageFetched(m,o);}});};l.prototype.$OmniMStore2=function(){var m=this.getState().get('prefs'),n=c('OmniMHelpers').suggestionMode(m),o=c('MercuryConfig').OmniMConfidenceThresholds[n];return o||.9;};l.prototype.$OmniMStore3=function(m){var n=this.$OmniMStore2();return (m||[]).filter(function(o){return o.confidence&&o.confidence>n;});};l.prototype.suggestionsForThread=function(m){var n=this.getState();if(!n.getIn(['threadMetadata',m]))this.$OmniMStore1(m);var o=n.getIn(['suggestionsByThread',m],{}),p=this.$OmniMStore3(o.agentSuggestions).slice(0,j);return babelHelpers['extends']({},o,{agentSuggestions:p});};l.prototype.prefs=function(){return this.getState().get('prefs');};l.prototype.$OmniMStore4=function(){var m=c('MercuryDispatcher').get();m.subscribe('update-messages',function(n,o){c('OmniMActions').mercuryDispatched(n,o);});m.subscribe('invalidate-thread-state',function(n,o){c('OmniMActions').mercuryDispatched(n,{threadID:o});});m.subscribe('invalidate-global-state',function(n){return c('OmniMActions').mercuryDispatched(n);});};l.prototype.$OmniMStore5=function(){if(c('MercuryConfig').OmniMEditConfidenceThreshold){var m=c('XMessagingOmniMPrefController').getURIBuilder().getURI();new (c('AsyncRequest'))(m).setAllowCrossPageTransition(true).setReadOnly(true).setMethod('POST').setHandler(function(n){return c('OmniMActions').prefsUpdated(n.payload);}).send();}};l.prototype.setUp=function(){this.$OmniMStore4();this.$OmniMStore5();};function l(){h.apply(this,arguments);}f.exports=new l(c('MessengerFluxReduceDispatcher'));}),null);
__d('HotLikeSound',['MercurySoundsConfig','SoundPlayer','StickerConstants'],(function a(b,c,d,e,f,g){'use strict';var h=[c('MercurySoundsConfig').hot_like_grow_mp3_url,c('MercurySoundsConfig').hot_like_grow_ogg_url],i=[c('MercurySoundsConfig').hot_like_pop_mp3_url,c('MercurySoundsConfig').hot_like_pop_ogg_url],j=[c('MercurySoundsConfig').hot_like_outgoing_small_mp3_url,c('MercurySoundsConfig').hot_like_outgoing_small_ogg_url],k=[c('MercurySoundsConfig').hot_like_outgoing_medium_mp3_url,c('MercurySoundsConfig').hot_like_outgoing_medium_ogg_url],l=[c('MercurySoundsConfig').hot_like_outgoing_large_mp3_url,c('MercurySoundsConfig').hot_like_outgoing_large_ogg_url],m=function o(){return false;},n={setCheckSoundEnabledFunc:function o(p){m=p;},start:function o(){this._play(h);},stop:function o(){c('SoundPlayer').stop(h);},pop:function o(){this.stop();this._play(i);},snap:function o(p){this.stop();if(p===c('StickerConstants').HOT_LIKE_SMALL_STICKER_ID)this._play(j);if(p===c('StickerConstants').HOT_LIKE_MEDIUM_STICKER_ID)this._play(k);if(p===c('StickerConstants').HOT_LIKE_LARGE_STICKER_ID)this._play(l);},_play:function o(p){if(m())c('SoundPlayer').play(p);}};f.exports=n;}),null);
__d('MercuryBlockedParticipants',['MercuryIDs','MercuryActionType','MercuryDispatcher','MercurySingletonProvider','Set'],(function a(b,c,d,e,f,g){'use strict';h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};function h(j){this.$MercuryBlockedParticipants1=j;this.$MercuryBlockedParticipants2=new (c('Set'))();this.$MercuryBlockedParticipants3=c('MercuryDispatcher').getForFBID(this.$MercuryBlockedParticipants1);this.$MercuryBlockedParticipants3.subscribe('update-blocked-users',function(k,l){if(l.message_blocked_ids)this.$MercuryBlockedParticipants2=new (c('Set'))(l.message_blocked_ids);var m=l.participants||[];for(var n=m,o=Array.isArray(n),p=0,n=o?n:n[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var q;if(o){if(p>=n.length)break;q=n[p++];}else{p=n.next();if(p.done)break;q=p.value;}var r=q;if(r.is_messenger_blocked===true)this.$MercuryBlockedParticipants4(r.fbid);if(r.is_messenger_blocked===false)this.$MercuryBlockedParticipants5(r.fbid);}}.bind(this));}h.prototype.getFBID=function(){return this.$MercuryBlockedParticipants1;};h.prototype.setIDs=function(j){this.$MercuryBlockedParticipants2=j;};h.prototype.getIDs=function(){return this.$MercuryBlockedParticipants6();};h.prototype.$MercuryBlockedParticipants6=function(){return this.$MercuryBlockedParticipants2;};h.prototype.$MercuryBlockedParticipants4=function(j){this.$MercuryBlockedParticipants2.add(c('MercuryIDs').getParticipantIDFromUserID(j.toString()));};h.prototype.$MercuryBlockedParticipants5=function(j){this.$MercuryBlockedParticipants2['delete'](c('MercuryIDs').getParticipantIDFromUserID(j.toString()));};h.prototype.isMessageBlocked=function(j){if(!j.is_canonical)return false;var k=j.participants.filter(function(l){return l!=c('MercuryIDs').getParticipantIDFromUserID(this.getFBID());}.bind(this));return !k.every(function(l){return !this.$MercuryBlockedParticipants2.has(l);}.bind(this));};h.prototype.isPresentInGroupThread=function(j){if(!j.is_canonical&&this.$MercuryBlockedParticipants7(j).length>0)return true;return false;};h.prototype.inGroupThread=function(j){if(j.is_canonical)return [];return this.$MercuryBlockedParticipants7(j);};h.prototype.$MercuryBlockedParticipants7=function(j){if(!j.participants)return [];var k=j.participants.filter(function(m){return m!=c('MercuryIDs').getParticipantIDFromUserID(this.getFBID());}.bind(this)),l=k.filter(function(m){return this.$MercuryBlockedParticipants2.has(m)!==false;}.bind(this));return l;};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;}),null);
__d('MercuryRoger',['Arbiter','ArbiterMixin','immutable','JSLogger','MercuryActionStatus','MercuryDispatcher','MercurySingletonProvider','MercuryThreads','mixin','mapObject'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('MercuryActionStatus').SUCCESS;h=babelHelpers.inherits(k,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;k.getForFBID=function(o){return l.getForFBID(o);};k.get=function(){return l.get();};function k(o){i.constructor.call(this);this.$MercuryRoger1={};this.$MercuryRoger2=[];this.$MercuryRoger3=o;this.$MercuryRoger4=c('MercuryDispatcher').getForFBID(this.$MercuryRoger3);this.$MercuryRoger5=c('MercuryThreads').getForFBID(this.$MercuryRoger3);this.$MercuryRoger4.subscribe('update-roger',function(p,q){for(var r in q){var s=this.$MercuryRoger1[r]||c('immutable').OrderedMap();s=s.withMutations(function(t){for(var u in q[r]){var v=this.$MercuryRoger5.getThreadMetaNow(r);if(v&&v.participants)if(v.participants.indexOf(u)==-1){this.$MercuryRoger2.push(n(this.$MercuryRoger1));continue;}var w=t.get(u),x=q[r][u];if(!w||x.watermark>w.watermark)t.set(u,x);}}.bind(this));this.$MercuryRoger1[r]=s.sort(function(t,u){return t.watermark-u.watermark;});}q&&this.inform('change',q);}.bind(this));this.$MercuryRoger4.subscribe('invalidate-global-state',function(){this.$MercuryRoger6();}.bind(this));c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(p,q){var r={};for(var s in this.$MercuryRoger1)if(Object.prototype.hasOwnProperty.call(this.$MercuryRoger1,s))r[s]=this.$MercuryRoger1[s].toObject();q.read_receipts={valid_receipts:r,bad_receipts:this.$MercuryRoger2};}.bind(this));}k.prototype.getSeenBy=function(o,p){if(!o)return [];var q=[],r=this.$MercuryRoger1[o.thread_id];if(!r)return q;r.forEach(function(s,t){if(m(o,s.watermark,t,p))q.push(t);});return q;};k.prototype.wasSeenByAll=function(o){if(!o)return false;var p=this.$MercuryRoger1[o.thread_id];if(!p)return false;return p.every(function(q,r){return m(o,q.watermark,r);});};k.prototype.getSeenTimestamps=function(o){var p=this.$MercuryRoger1[o];if(!p){p=c('immutable').OrderedMap();this.$MercuryRoger1[o]=p;}return p;};k.prototype.getSeenTimestamp=function(o,p){var q=this.$MercuryRoger1[o];return q?q.get(p):null;};k.prototype.$MercuryRoger6=function(){this.$MercuryRoger1={};this.$MercuryRoger2=[];};var l=new (c('MercurySingletonProvider'))(k);function m(o,p,q,r){return !!(p>=o.timestamp&&(o.status===undefined||o.status===j)&&(!r||q!=o.author));}function n(o){return c('mapObject')(o,function(p){return p.toJS();});}f.exports=k;}),null);
__d('MercuryDelayedRoger',['ArbiterMixin','LiveTimer','MercuryActionStatus','MercuryConfig','MercuryMessages','MercuryRoger','MercurySingletonProvider','MercuryThreadInformer','MercuryThreads','mixin','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g){var h,i,j=c('MercuryConfig')['roger.seen_delay'];h=babelHelpers.inherits(k,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;k.getForFBID=function(m){'use strict';return l.getForFBID(m);};k.get=function(){'use strict';return l.get();};function k(m){'use strict';i.constructor.call(this);this.$MercuryDelayedRoger9=function(event,n){var o={};for(var p in n)if(this.$MercuryDelayedRoger11(p))o[p]=true;Object.keys(o).forEach(function(q){return this.$MercuryDelayedRoger12(o);}.bind(this));}.bind(this);this.$MercuryDelayedRoger1=m;this.$MercuryDelayedRoger2=c('MercuryRoger').getForFBID(m);this.$MercuryDelayedRoger4={};this.$MercuryDelayedRoger5={};this.$MercuryDelayedRoger2.subscribe('change',function(n,o){for(var p in o)!this.$MercuryDelayedRoger5[p]&&this.$MercuryDelayedRoger8(p);}.bind(this));this.$MercuryDelayedRoger3=c('MercuryThreadInformer').getForFBID(m);this.$MercuryDelayedRoger6=c('MercuryMessages').getForFBID(m);this.$MercuryDelayedRoger7=c('MercuryThreads').getForFBID(m);this.$MercuryDelayedRoger3.subscribe('messages-received',this.$MercuryDelayedRoger9);this.$MercuryDelayedRoger3.subscribe('messages-reordered',this.$MercuryDelayedRoger9);this.$MercuryDelayedRoger3.subscribe('messages-updated',this.$MercuryDelayedRoger9);}k.prototype.getSeenBy=function(m,n){'use strict';if(this.$MercuryDelayedRoger5[m])return [];return this.$MercuryDelayedRoger2.getSeenBy(this.$MercuryDelayedRoger10(m),n);};k.prototype.wasSeenByAll=function(m){'use strict';if(this.$MercuryDelayedRoger5[m])return false;return this.$MercuryDelayedRoger2.wasSeenByAll(this.$MercuryDelayedRoger10(m));};k.prototype.$MercuryDelayedRoger10=function(m){'use strict';if(!this.$MercuryDelayedRoger4[m]){var n=this.$MercuryDelayedRoger7.getThreadMetaNow(m);if(n)this.$MercuryDelayedRoger4[m]={thread_id:m,author:n.participants[0],timestamp:n.timestamp};}return this.$MercuryDelayedRoger4[m];};k.prototype.$MercuryDelayedRoger11=function(m){'use strict';var n=false;this.$MercuryDelayedRoger6.getThreadMessagesRange(m,0,1,function(o){var p=o[0];if(!p)return;var q=p.timestamp;if(p.status===c('MercuryActionStatus').SUCCESS)q-=c('LiveTimer').getServerTimeOffset();var r=this.getSeenBy(m);if(this.$MercuryDelayedRoger5[m]){clearTimeout(this.$MercuryDelayedRoger5[m]);delete this.$MercuryDelayedRoger5[m];}var s=q+j,t=s-Date.now();if(t>0)this.$MercuryDelayedRoger5[m]=c('setTimeoutAcrossTransitions')(function(){delete this.$MercuryDelayedRoger5[m];this.$MercuryDelayedRoger8(m);}.bind(this),t);this.$MercuryDelayedRoger4[m]=p;var u=this.getSeenBy(m);if(r.length||u.length)n=true;}.bind(this));return n;};k.prototype.$MercuryDelayedRoger8=function(m){'use strict';var n={};n[m]=true;this.$MercuryDelayedRoger12(n);};k.prototype.$MercuryDelayedRoger12=function(m){'use strict';this.inform('state-changed',m);this.inform('change');};var l=new (c('MercurySingletonProvider'))(k);f.exports=k;}),null);
__d('MercuryDeliveryReceipts',['ArbiterMixin','Map','MercuryDispatcher','MercurySingletonProvider','mixin'],(function a(b,c,d,e,f,g){var h,i;h=babelHelpers.inherits(j,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;function j(l){'use strict';i.constructor.call(this);this.$MercuryDeliveryReceipts2=l;this.$MercuryDeliveryReceipts3=new (c('Map'))();this.$MercuryDeliveryReceipts1=c('MercuryDispatcher').getForFBID(this.$MercuryDeliveryReceipts2);this.$MercuryDeliveryReceipts1.subscribe('update-delivery',function(m,n){if(n.delivery_receipts)for(var o in n.delivery_receipts){var p=n.delivery_receipts[o],q=this.$MercuryDeliveryReceipts3.get(o)||0;if(p>q){this.$MercuryDeliveryReceipts3.set(o,p);this.informDeliveryStatusChanged(o);}}}.bind(this));}j.getForFBID=function(l){'use strict';return k.getForFBID(l);};j.get=function(){'use strict';return k.get();};j.prototype.informDeliveryStatusChanged=function(l){'use strict';var m=new (c('Map'))();m.set(l,true);this.inform('change',m);};j.prototype.getDeliveryTime=function(l){'use strict';return this.$MercuryDeliveryReceipts3.get(l)||0;};var k=new (c('MercurySingletonProvider'))(j);f.exports=j;}),null);
__d('MercuryDeliveryState',['MercuryConfig','MercuryIDs','MercuryServerRequests','MercurySingletonProvider','MercuryThreadIDMap','MercuryThreadInformer','PresencePrivacy','UserActivity','debounceAcrossTransitions'],(function a(b,c,d,e,f,g){'use strict';var h=c('MercuryConfig').delivery_timeout||120000;i.getForFBID=function(k){return j.getForFBID(k);};i.get=function(){return j.get();};function i(k){this.$MercuryDeliveryState1=k;this.$MercuryDeliveryState2=c('MercuryServerRequests').getForFBID(this.$MercuryDeliveryState1);this.$MercuryDeliveryState3=c('MercuryThreadInformer').getForFBID(this.$MercuryDeliveryState1);this.$MercuryDeliveryState4=c('MercuryThreadIDMap').getForFBID(this.$MercuryDeliveryState1);this.$MercuryDeliveryState5=[];this.$MercuryDeliveryState6={};this.$MercuryDeliveryState3.subscribe('messages-received',this.$MercuryDeliveryState7.bind(this));c('UserActivity').subscribe(c('debounceAcrossTransitions')(this.$MercuryDeliveryState8,300,this));}i.prototype.$MercuryDeliveryState7=function(k,l){for(var m in l){var n=l[m];n.forEach(function(o){if(this.$MercuryDeliveryState9(o)){this.$MercuryDeliveryState5.push(o);this.$MercuryDeliveryState4.getServerIDFromClientID(m,function(p){if(!this.$MercuryDeliveryState6[p])this.$MercuryDeliveryState6[p]=[];this.$MercuryDeliveryState6[p].push(o.message_id);}.bind(this));}}.bind(this));}if(c('UserActivity').isActive(h))this.$MercuryDeliveryState8();};i.prototype.$MercuryDeliveryState8=function(){if(this.$MercuryDeliveryState5.length===0&&Object.keys(this.$MercuryDeliveryState6).length===0)return;var k=this.$MercuryDeliveryState5.map(function(l){return l.message_id;});if(k)this.$MercuryDeliveryState2.sendDeliveryReceipts(k,this.$MercuryDeliveryState6);this.$MercuryDeliveryState6={};this.$MercuryDeliveryState5=[];};i.prototype.$MercuryDeliveryState9=function(k){var l=k.author?c('MercuryIDs').getUserIDFromParticipantID(k.author):null;if(l===this.$MercuryDeliveryState1)return false;if(!k.is_unread)return false;if(!c('PresencePrivacy').allows(l))return false;return true;};var j=new (c('MercurySingletonProvider'))(i);f.exports=i;}),null);
__d('MercuryUnseenState',['MercuryFolders','KeyedCallbackManager','LogHistory','MercuryActionType','MercuryDispatcher','MercurySingletonProvider','MercuryThreadIDMap','MercuryThreadInfo','MercuryThreadlistConstants','MessagingTag','MercuryServerRequests','MercuryThreadInformer','MercuryThreads','createObjectFrom','isEmpty'],(function a(b,c,d,e,f,g){'use strict';var h=c('MercuryThreadlistConstants').MAX_UNSEEN_COUNT,i='unseen_thread_hash',j='unseen_thread_list',k=c('LogHistory').getInstance('mercury_unseen_state');l.getForFBID=function(n){return m.getForFBID(n);};l.get=function(){return m.get();};function l(n){this.$MercuryUnseenState2=n;this.$MercuryUnseenState7=c('MercuryServerRequests').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState8=c('MercuryThreadIDMap').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState10=c('MercuryThreads').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState9=c('MercuryThreadInformer').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState1=c('MercuryDispatcher').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState3=0;this.$MercuryUnseenState4=0;this.$MercuryUnseenState5=false;this.$MercuryUnseenState6=false;this.$MercuryUnseenState11=new (c('KeyedCallbackManager'))();this.$MercuryUnseenState1.subscribe('update-unseen',function(o,p){this.$MercuryUnseenState12(p);}.bind(this));this.$MercuryUnseenState1.subscribe('update-thread-ids',function(o,p){this.$MercuryUnseenState13(p);}.bind(this));}l.prototype.getUnseenCount=function(){if(this.exceedsMaxCount()){k.error('unguarded_unseen_count_fetch','{}');return 0;}return this.$MercuryUnseenState14();};l.prototype.exceedsMaxCount=function(){return this.$MercuryUnseenState5||this.$MercuryUnseenState14()>h;};l.prototype.markAsSeen=function(){var n=this.$MercuryUnseenState14();if(n===null){this.$MercuryUnseenState6=true;}else if(n>0||this.$MercuryUnseenState5){this.$MercuryUnseenState7.markSeen();this.$MercuryUnseenState15(this.$MercuryUnseenState7.getLastActionTimestamp(),[]);}};l.prototype.$MercuryUnseenState16=function(n,o){var p;this.$MercuryUnseenState17((p={},p[n]=0,p),o);};l.prototype.$MercuryUnseenState18=function(n){this.$MercuryUnseenState11.setResource(i,n);this.$MercuryUnseenState11.setResource(j,Object.keys(n));};l.prototype.$MercuryUnseenState19=function(n){var o=this.$MercuryUnseenState11.executeOrEnqueue(i,n),p=this.$MercuryUnseenState11.getUnavailableResources(o);if(p.length)this.$MercuryUnseenState7.fetchUnseenThreadIDs();};l.prototype.$MercuryUnseenState20=function(){return this.$MercuryUnseenState11.getResource(i);};l.prototype.$MercuryUnseenState14=function(){var n=this.$MercuryUnseenState11.getResource(j);if(n){return n.length;}else return this.$MercuryUnseenState3;};l.prototype.$MercuryUnseenState12=function(n){var o,p=this,q=this.$MercuryUnseenState21(n);if(n.unseen_thread_fbids){n.unseen_thread_fbids.forEach(function(r){if(r.folder!=c('MessagingTag').INBOX)return;var s=(r.thread_fbids||[]).concat(r.other_user_fbids||[]),t=this.$MercuryUnseenState22(s),u=q.seen_timestamp?q.seen_timestamp:this.$MercuryUnseenState4;this.$MercuryUnseenState15(u,t);if(q.unseen_count>h)this.$MercuryUnseenState5=true;}.bind(this));}else if(q.seen_timestamp!==undefined){this.$MercuryUnseenState4=q.seen_timestamp;if(q.unseen_count>h){this.$MercuryUnseenState5=true;this.$MercuryUnseenState18({});}else{this.$MercuryUnseenState3=q.unseen_count;if(this.$MercuryUnseenState3===0)this.$MercuryUnseenState18({});}}else{var o=function(){var r;if(p.$MercuryUnseenState5)return {v:void 0};var s=n.actions;if(!s||!s.length)return {v:void 0};var t={},u={},v=function x(y){var z=s[y],aa=z.action_type,ba=z.other_user_fbid?z.other_user_fbid:z.thread_fbid,ca=z.thread_id?z.thread_id:ba;if(aa===c('MercuryActionType').MARK_THREAD_SEEN){p.$MercuryUnseenState16(ca,z.persistent);return 'continue';}if(!p.$MercuryUnseenState23(z))return 'continue';if(aa===c('MercuryActionType').USER_GENERATED_MESSAGE||aa===c('MercuryActionType').LOG_MESSAGE){var da=t[ca]?z.timestamp>t[ca]:false,ea=da||!t[ca];if(z.is_unread&&ea)p.$MercuryUnseenState10.getThreadMeta(ca,function(fa){var ga=false;if(fa&&fa.last_read_timestamp)if(fa.last_read_timestamp>=z.timestamp)ga=true;if(!c('MercuryThreadInfo').isMuted(fa)&&!ga)t[ca]=z.timestamp;});}else if(aa===c('MercuryActionType').CHANGE_READ_STATUS&&z.mark_as_read)u[ca]=z.timestamp;};for(var w=0;w<s.length;w++){var r=v(w);if(r==='continue')continue;}p.$MercuryUnseenState24(t);p.$MercuryUnseenState17(u);}();if(typeof o==="object")return o.v;}if(this.$MercuryUnseenState6){this.$MercuryUnseenState6=false;this.markAsSeen();}};l.prototype.$MercuryUnseenState15=function(n,o){var p=this.$MercuryUnseenState20();if(p===undefined||n>this.$MercuryUnseenState4||this.$MercuryUnseenState5){this.$MercuryUnseenState4=n;o=o||[];if(o.length<=h)this.$MercuryUnseenState5=false;var q={},r=this.$MercuryUnseenState20();for(var s in r)if(r[s]!==true){var t=r[s];if(this.$MercuryUnseenState25(t))q[s]=t;}var u=Object.assign(c('createObjectFrom')(o,true),q);this.$MercuryUnseenState18(u);this.$MercuryUnseenState9.updatedUnseenState();}};l.prototype.$MercuryUnseenState24=function(n){if(this.$MercuryUnseenState5)return;var o={},p=false;for(var q in n){var r=n[q];if(this.$MercuryUnseenState25(r)){o[q]=r;p=true;}}if(!p)return;this.$MercuryUnseenState19(function(s){for(var t in o){var u=o[t];if(!s[t]&&this.$MercuryUnseenState25(u))s[t]=o[t];}this.$MercuryUnseenState18(s);this.$MercuryUnseenState9.updatedUnseenState();}.bind(this));};l.prototype.$MercuryUnseenState17=function(n,o){if(!c('isEmpty')(n))this.$MercuryUnseenState19(function(p){var q=false;for(var r in n){var s=n[r],t=s>=p[r];if(p[r]&&(!s||t)){delete p[r];q=true;}}if(q){this.$MercuryUnseenState18(p);this.$MercuryUnseenState9.updatedUnseenState();if(o&&this.$MercuryUnseenState14()===0)this.$MercuryUnseenState7.markSeen();}}.bind(this));};l.prototype.$MercuryUnseenState25=function(n){return n>this.$MercuryUnseenState4;};l.prototype.$MercuryUnseenState22=function(n){return n.map(this.$MercuryUnseenState8.convertThreadIDIfAvailable,this.$MercuryUnseenState8);};l.prototype.$MercuryUnseenState13=function(n){var o=this.$MercuryUnseenState20();if(!o)return;for(var p in n){var q=n[p];if(o[p]){o[q]=o[p];delete o[p];}}this.$MercuryUnseenState18(o);};l.prototype.$MercuryUnseenState23=function(n){var o=n.thread_id?this.$MercuryUnseenState10.getThreadMetaNow(n.thread_id):null,p=o?c('MercuryFolders').getFromMeta(o):n.folder;return p===c('MessagingTag').INBOX||p===undefined;};l.prototype.$MercuryUnseenState21=function(n){var o=n.message_counts||[];for(var p=0;p<o.length;p++)if(o[p].folder===c('MessagingTag').INBOX)return o[p];return {};};var m=new (c('MercurySingletonProvider'))(l);f.exports=l;}),null);
__d('MercuryNotificationRenderer',['fbt','MercuryAssert','MercuryIDs','MercuryMessages','MercuryParticipants','MercuryThreads','MercuryViewer','MessagingGenericAdminTextType'],(function a(b,c,d,e,f,g,h){var i=c('MercuryMessages').get(),j=c('MercuryThreads').get();function k(l,m){c('MercuryAssert').isThreadID(l);j.getThreadMeta(l,function(n){i.getThreadMessagesRange(l,0,1,function(o){var p=o.length&&o[o.length-1];if(p.log_message_type==c('MessagingGenericAdminTextType').CONFIRM_FRIEND_REQUEST){m(h._("New contact added"));}else if(p&&p.author!=c('MercuryViewer').getID()){c('MercuryParticipants').get(p.author,function(q){var r=q.short_name;if(n.custom_nickname){var s=c('MercuryIDs').getUserIDFromParticipantID(q.id);if(n.custom_nickname[s])r=n.custom_nickname[s];}if(n.name){m(h._("{senderName} messaged {groupName}",[h.param('senderName',r),h.param('groupName',n.name)]));}else if(c('MercuryIDs').isGroupChat(l)){m(h._("{name} messaged your group",[h.param('name',r)]));}else m(h._("{name} messaged you",[h.param('name',r)]));});}else m(h._("New message!"));});});}f.exports={renderDocumentTitle:k};}),null);
__d('MercuryMessageCustomizations',[],(function a(b,c,d,e,f,g){'use strict';function h(j,k){var l=j.customizations;if(!l)return null;var m=l.filter(function(n){return n.customization_type===k;});return m.length>0?m[0].customization_value:null;}function i(j){var k=JSON.parse(j),l=[];Object.keys(k).forEach(function(m){l.push({customization_type:m,customization_value:k[m]});});return l;}f.exports={getCustomizationValue:h,parseCustomizations:i};}),null);
__d('MercurySyncEnvironment',['Arbiter','ChannelInitialData','CurrentUser','MercurySyncDeltaHandler'],(function a(b,c,d,e,f,g){'use strict';function h(){if(!c('ChannelInitialData').channelConfig)return;c('MercurySyncDeltaHandler').get();c('Arbiter').inform('MercurySyncDeltaHandler/initSeqID',{fbid:c('CurrentUser').getAccountID(),seqID:c('ChannelInitialData').channelConfig.sequenceId});}f.exports={setUp:h};}),null);